{"version":3,"file":"page-activitypage-CAtFiV2V.js","sources":["../../src/pages/ActivityPage.js"],"sourcesContent":["/**\n * Activity Page\n * Display PIM audit logs and activity history\n */\n\nimport { BasePage } from '../core/PageRouter.js';\nimport { graphService } from '../services/graphService.js';\nimport { CACHE_KEYS } from '../core/CacheManager.js';\n\nexport class ActivityPage extends BasePage {\n    constructor(app) {\n        super(app);\n        this.paginator = app.paginators.activity;\n    }\n\n    /**\n     * Render Activity page\n     * @param {HTMLElement} container - Page container\n     * @param {Object} params - Optional parameters\n     */\n    async render(container, params = {}) {\n        let allLogs = [];\n\n        if (this.isConnected()) {\n            this.showLoading('Loading PIM activity...');\n\n            const result = await graphService.getPIMAuditLogs(30); // Last 30 days\n            if (result.success) {\n                allLogs = result.logs;\n            } else {\n                this.showToast(`Failed to load activity: ${result.error}`, 'error');\n            }\n\n            this.hideLoading();\n        }\n\n        // Update paginator with all logs\n        this.paginator.updateItems(allLogs);\n\n        // Get current page items\n        const logs = this.paginator.getCurrentPageItems();\n\n        const formatDate = (dateStr) => {\n            if (!dateStr) return 'N/A';\n            const date = new Date(dateStr);\n            return date.toLocaleString();\n        };\n\n        const getActivityIcon = (displayName) => {\n            if (displayName?.includes('Add') || displayName?.includes('Create')) return 'fa-plus success';\n            if (displayName?.includes('Remove') || displayName?.includes('Delete')) return 'fa-trash danger';\n            if (displayName?.includes('Update')) return 'fa-edit warning';\n            if (displayName?.includes('Assign')) return 'fa-user-check primary';\n            return 'fa-circle info';\n        };\n\n        container.innerHTML = `\n            <!-- Dramatic Page Header -->\n            <div style=\"position: relative; margin-bottom: var(--space-2xl); overflow: hidden;\">\n                <div style=\"position: absolute; top: -50%; right: -5%; width: 300px; height: 300px; background: radial-gradient(circle, var(--accent-secondary-dim), transparent); filter: blur(80px); animation: float 10s ease-in-out infinite; pointer-events: none;\"></div>\n                <div style=\"position: relative; z-index: 1;\">\n                    <div style=\"display: inline-flex; align-items: center; gap: var(--space-xs); padding: var(--space-xs) var(--space-md); background: rgba(255, 0, 128, 0.05); border: 1px solid var(--accent-secondary); border-radius: var(--radius-full); margin-bottom: var(--space-md); font-family: var(--font-mono); font-size: 0.65rem; text-transform: uppercase; letter-spacing: 0.15em;\">\n                        <i class=\"fas fa-database\" style=\"color: var(--accent-secondary); font-size: 0.7rem;\"></i>\n                        <span style=\"color: var(--accent-secondary); font-weight: 600;\">AUDIT TRAIL</span>\n                        <span style=\"color: var(--text-muted);\">|</span>\n                        <span style=\"color: var(--text-secondary);\">30 DAY HISTORY</span>\n                    </div>\n                    <h1 style=\"font-family: var(--font-display); font-size: clamp(2rem, 4vw, 3rem); font-weight: 800; line-height: 1.1; margin-bottom: var(--space-sm); letter-spacing: -0.03em;\">\n                        <span style=\"background: linear-gradient(135deg, var(--accent-secondary), #ff00ff); -webkit-background-clip: text; -webkit-text-fill-color: transparent; filter: drop-shadow(0 0 30px rgba(255, 0, 128, 0.3));\">\n                            ACTIVITY\n                        </span>\n                        <span style=\"color: var(--text-primary);\"> LOG</span>\n                    </h1>\n                    <p style=\"font-size: 0.95rem; color: var(--text-secondary); font-family: var(--font-mono);\">\n                        Complete audit trail of privileged role management events\n                    </p>\n                </div>\n            </div>\n\n            <div class=\"card\" style=\"position: relative; overflow: hidden; background: linear-gradient(135deg, var(--bg-elevated), var(--bg-surface)); border: 1px solid var(--border-subtle);\">\n                <div style=\"position: absolute; top: 0; right: 0; width: 400px; height: 400px; background: radial-gradient(circle, var(--accent-secondary-dim), transparent); filter: blur(100px); pointer-events: none;\"></div>\n\n                <div style=\"position: relative; z-index: 1;\">\n                    <div style=\"display: flex; align-items: center; justify-content: space-between; padding: var(--space-lg); border-bottom: 1px solid var(--border-subtle);\">\n                        <div style=\"display: flex; align-items: center; gap: var(--space-md);\">\n                            <div style=\"width: 48px; height: 48px; background: var(--accent-secondary-dim); border-radius: var(--radius-md); display: flex; align-items: center; justify-content: center;\">\n                                <i class=\"fas fa-history\" style=\"color: var(--accent-secondary); font-size: 1.3rem;\"></i>\n                            </div>\n                            <div>\n                                <h2 style=\"font-family: var(--font-display); font-size: 1.4rem; font-weight: 700; margin: 0; text-transform: uppercase; letter-spacing: 0.05em;\">\n                                    Event Stream\n                                </h2>\n                                <div style=\"font-family: var(--font-mono); font-size: 0.75rem; color: var(--text-secondary); margin-top: 2px;\">\n                                    ${allLogs.length} recorded events\n                                </div>\n                            </div>\n                        </div>\n                        <div style=\"display: flex; gap: var(--space-sm);\">\n                            <button class=\"btn btn-secondary btn-sm\" onclick=\"app.showExportMenu('activity')\" ${!this.isConnected() || allLogs.length === 0 ? 'disabled' : ''} style=\"font-family: var(--font-mono);\">\n                                <i class=\"fas fa-file-export\"></i> EXPORT\n                            </button>\n                            <button class=\"btn btn-secondary btn-sm\" onclick=\"app.pages.activity.refreshPage()\" ${!this.isConnected() ? 'disabled' : ''} style=\"font-family: var(--font-mono);\">\n                                <i class=\"fas fa-sync\"></i> REFRESH\n                            </button>\n                        </div>\n                    </div>\n\n                    <div style=\"overflow-x: auto;\">\n                        ${logs.length > 0 ? `\n                            <table class=\"table\" style=\"margin: 0;\">\n                                <thead>\n                                    <tr style=\"background: rgba(0, 0, 0, 0.3);\">\n                                        <th style=\"width: 40px; font-family: var(--font-mono); font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.1em;\"></th>\n                                        <th style=\"font-family: var(--font-mono); font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.1em;\">Activity</th>\n                                        <th style=\"font-family: var(--font-mono); font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.1em;\">Initiated By</th>\n                                        <th style=\"font-family: var(--font-mono); font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.1em;\">Target</th>\n                                        <th style=\"font-family: var(--font-mono); font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.1em;\">Timestamp</th>\n                                        <th style=\"font-family: var(--font-mono); font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.1em;\">Status</th>\n                                    </tr>\n                                </thead>\n                                <tbody>\n                                    ${logs.map((log, idx) => `\n                                        <tr style=\"border-bottom: 1px solid var(--border-subtle); background: ${idx % 2 === 0 ? 'rgba(255, 0, 128, 0.02)' : 'transparent'};\">\n                                            <td>\n                                                <div style=\"width: 28px; height: 28px; border-radius: 50%; background: rgba(255, 0, 128, 0.1); display: flex; align-items: center; justify-content: center;\">\n                                                    <i class=\"fas ${getActivityIcon(log.activityDisplayName).split(' ')[0]}\" style=\"font-size: 0.75rem; color: var(--accent-secondary);\"></i>\n                                                </div>\n                                            </td>\n                                            <td>\n                                                <div style=\"font-weight: 600; font-size: 0.9rem; margin-bottom: 2px; color: var(--text-primary);\">${this.escapeHtml(log.activityDisplayName || 'Unknown Activity')}</div>\n                                                <div style=\"font-size: 0.75rem; color: var(--text-muted); font-family: var(--font-mono);\">${this.escapeHtml(log.category || 'N/A')}</div>\n                                            </td>\n                                            <td>\n                                                <div style=\"font-size: 0.9rem; font-weight: 500; color: var(--text-primary);\">${this.escapeHtml(log.initiatedBy?.user?.displayName || 'System')}</div>\n                                                <div style=\"font-size: 0.75rem; color: var(--text-muted); font-family: var(--font-mono);\">${this.escapeHtml(log.initiatedBy?.user?.userPrincipalName || 'N/A')}</div>\n                                            </td>\n                                            <td>\n                                                ${log.targetResources?.map(t => `\n                                                    <div style=\"font-size: 0.85rem; color: var(--text-secondary);\">${this.escapeHtml(t.displayName || t.id || 'N/A')}</div>\n                                                `).join('') || '<span style=\"color: var(--text-muted); font-family: var(--font-mono); font-size: 0.75rem;\">N/A</span>'}\n                                            </td>\n                                            <td style=\"white-space: nowrap; font-family: var(--font-mono); font-size: 0.8rem; color: var(--text-secondary);\">\n                                                ${formatDate(log.activityDateTime)}\n                                            </td>\n                                            <td>\n                                                <span class=\"badge\" style=\"background: ${log.result === 'success' ? 'var(--color-success-dim)' : 'var(--color-error-dim)'}; color: ${log.result === 'success' ? 'var(--color-success)' : 'var(--color-error)'}; font-family: var(--font-mono); font-size: 0.7rem; text-transform: uppercase;\">\n                                                    ${log.result === 'success' ? '✓ SUCCESS' : '✗ FAILED'}\n                                                </span>\n                                            </td>\n                                        </tr>\n                                    `).join('')}\n                                </tbody>\n                            </table>\n                        ` : `\n                            <div style=\"text-align: center; padding: var(--space-2xl) var(--space-lg); color: var(--text-secondary);\">\n                                <div style=\"width: 120px; height: 120px; margin: 0 auto var(--space-xl); background: var(--accent-secondary-dim); border-radius: 50%; display: flex; align-items: center; justify-content: center;\">\n                                    <i class=\"fas fa-history\" style=\"font-size: 3.5rem; color: var(--accent-secondary); opacity: 0.5;\"></i>\n                                </div>\n                                <div style=\"font-family: var(--font-display); font-size: 1.5rem; font-weight: 700; margin-bottom: var(--space-sm); color: var(--text-primary);\">\n                                    No Activity Detected\n                                </div>\n                                <div style=\"font-family: var(--font-mono); font-size: 0.9rem; color: var(--text-muted);\">\n                                    ${this.isConnected() ? 'No audit logs found in the last 30 days' : 'Connect to Microsoft Entra ID to view activity logs'}\n                                </div>\n                            </div>\n                        `}\n                    </div>\n\n                    ${this.paginator.renderControls('app.pages.activity.handlePageChange')}\n                </div>\n            </div>\n        `;\n    }\n\n    /**\n     * Handle page change\n     * @param {number} page - Page number\n     */\n    handlePageChange(page) {\n        this.paginator.goToPage(page);\n        this.app.router.refreshCurrentPage();\n    }\n\n    /**\n     * Handle page size change\n     * @param {number} size - Page size\n     */\n    handlePageSizeChange(size) {\n        this.paginator.setPageSize(size);\n        this.app.router.refreshCurrentPage();\n    }\n\n    /**\n     * Refresh page data\n     */\n    async refreshPage() {\n        await this.app.router.refreshCurrentPage();\n    }\n}\n"],"names":["ActivityPage","BasePage","app","container","params","allLogs","result","graphService","logs","formatDate","dateStr","getActivityIcon","displayName","log","idx","t","page","size"],"mappings":"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"}