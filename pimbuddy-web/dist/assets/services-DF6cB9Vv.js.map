{"version":3,"file":"services-DF6cB9Vv.js","sources":["../../src/config/authConfig.js","../../src/services/authService.js","../../src/services/graphService.js","../../src/services/templateService.js","../../src/services/pimmaidService.js","../../src/services/baselineService.js"],"sourcesContent":["/**\n * MSAL Configuration for PIMBuddy\n * Supports both manual configuration and auto-bootstrapped app registration\n */\n\n/**\n * Get the MSAL configuration\n * Checks for saved config from bootstrap, otherwise uses manual config\n */\nexport function getMsalConfig() {\n    // Check for bootstrapped app configuration\n    const savedConfig = getSavedAppConfig();\n\n    if (savedConfig && savedConfig.clientId && savedConfig.tenantId) {\n        console.log('Using bootstrapped app configuration');\n        return {\n            auth: {\n                clientId: savedConfig.clientId,\n                authority: `https://login.microsoftonline.com/${savedConfig.tenantId}`,\n                redirectUri: window.location.origin,\n                postLogoutRedirectUri: window.location.origin,\n                navigateToLoginRequestUrl: true\n            },\n            cache: {\n                cacheLocation: \"sessionStorage\",\n                storeAuthStateInCookie: false\n            },\n            system: {\n                loggerOptions: {\n                    logLevel: 3,\n                    loggerCallback: (level, message, containsPii) => {\n                        if (containsPii) return;\n                        switch (level) {\n                            case 0: console.error(message); break;\n                            case 1: console.warn(message); break;\n                            case 2: console.info(message); break;\n                            case 3: console.debug(message); break;\n                        }\n                    }\n                }\n            }\n        };\n    }\n\n    // Fall back to manual configuration\n    console.log('No saved config found - will need to bootstrap or configure manually');\n    return null;\n}\n\n/**\n * Get saved app configuration from localStorage\n */\nexport function getSavedAppConfig() {\n    const saved = localStorage.getItem('pimbuddy-app-config');\n    if (saved) {\n        try {\n            return JSON.parse(saved);\n        } catch {\n            return null;\n        }\n    }\n    return null;\n}\n\n/**\n * Check if app is configured\n */\nexport function isAppConfigured() {\n    const config = getSavedAppConfig();\n    return config && config.clientId && config.tenantId;\n}\n\n/**\n * Clear saved app configuration\n */\nexport function clearAppConfig() {\n    localStorage.removeItem('pimbuddy-app-config');\n}\n\n// Scopes for Microsoft Graph API\nexport const loginRequest = {\n    scopes: [\"User.Read\"]\n};\n\n// Scopes for PIM operations\nexport const graphScopes = {\n    // Basic user info\n    user: [\"User.Read\"],\n\n    // Group operations\n    groups: [\n        \"Group.Read.All\",\n        \"Group.ReadWrite.All\"\n    ],\n\n    // PIM for Groups\n    pimGroups: [\n        \"PrivilegedAccess.Read.AzureADGroup\",\n        \"PrivilegedAccess.ReadWrite.AzureADGroup\",\n        \"PrivilegedEligibilitySchedule.Read.AzureADGroup\",\n        \"PrivilegedEligibilitySchedule.ReadWrite.AzureADGroup\",\n        \"PrivilegedAssignmentSchedule.Read.AzureADGroup\",\n        \"PrivilegedAssignmentSchedule.ReadWrite.AzureADGroup\"\n    ],\n\n    // Role management\n    roles: [\n        \"RoleManagement.Read.Directory\",\n        \"RoleManagement.ReadWrite.Directory\"\n    ],\n\n    // All scopes combined for full access\n    all: [\n        \"User.Read\",\n        \"Group.Read.All\",\n        \"Group.ReadWrite.All\",\n        \"RoleManagement.Read.Directory\",\n        \"RoleManagement.ReadWrite.Directory\",\n        \"PrivilegedAccess.Read.AzureADGroup\",\n        \"PrivilegedAccess.ReadWrite.AzureADGroup\",\n        \"PrivilegedEligibilitySchedule.Read.AzureADGroup\",\n        \"PrivilegedEligibilitySchedule.ReadWrite.AzureADGroup\",\n        \"PrivilegedAssignmentSchedule.Read.AzureADGroup\",\n        \"PrivilegedAssignmentSchedule.ReadWrite.AzureADGroup\"\n    ]\n};\n\n// Graph API endpoints\nexport const graphEndpoints = {\n    me: \"https://graph.microsoft.com/v1.0/me\",\n    groups: \"https://graph.microsoft.com/v1.0/groups\",\n    roleDefinitions: \"https://graph.microsoft.com/v1.0/roleManagement/directory/roleDefinitions\",\n    roleAssignments: \"https://graph.microsoft.com/v1.0/roleManagement/directory/roleAssignmentScheduleInstances\",\n    pimGroupPolicies: \"https://graph.microsoft.com/v1.0/policies/roleManagementPolicies\",\n    pimGroupAssignments: \"https://graph.microsoft.com/v1.0/identityGovernance/privilegedAccess/group\"\n};\n","/**\n * Authentication Service using MSAL.js\n * Handles login, logout, and token acquisition\n */\n\nimport { PublicClientApplication, InteractionRequiredAuthError } from '@azure/msal-browser';\nimport { getMsalConfig, graphScopes, isAppConfigured } from '../config/authConfig.js';\n\nclass AuthService {\n    constructor() {\n        this.msalInstance = null;\n        this.account = null;\n        this.initialized = false;\n    }\n\n    /**\n     * Check if the app is configured (has client ID)\n     */\n    isConfigured() {\n        return isAppConfigured();\n    }\n\n    /**\n     * Initialize MSAL instance\n     */\n    async initialize() {\n        if (this.initialized) return true;\n\n        const msalConfig = getMsalConfig();\n        if (!msalConfig) {\n            console.log('MSAL not configured - bootstrap required');\n            return false;\n        }\n\n        try {\n            this.msalInstance = new PublicClientApplication(msalConfig);\n            await this.msalInstance.initialize();\n\n            // Handle redirect response\n            const response = await this.msalInstance.handleRedirectPromise();\n            if (response) {\n                this.account = response.account;\n            } else {\n                // Check for existing accounts\n                const accounts = this.msalInstance.getAllAccounts();\n                if (accounts.length > 0) {\n                    this.account = accounts[0];\n                }\n            }\n\n            this.initialized = true;\n            console.log('MSAL initialized successfully');\n            return true;\n        } catch (error) {\n            console.error('MSAL initialization failed:', error);\n            throw error;\n        }\n    }\n\n    /**\n     * Re-initialize after bootstrap (when config changes)\n     */\n    async reinitialize() {\n        this.msalInstance = null;\n        this.account = null;\n        this.initialized = false;\n        return await this.initialize();\n    }\n\n    /**\n     * Check if user is authenticated\n     */\n    isAuthenticated() {\n        return this.account !== null;\n    }\n\n    /**\n     * Get current account info\n     */\n    getAccount() {\n        return this.account;\n    }\n\n    /**\n     * Login with popup\n     */\n    async login() {\n        if (!this.msalInstance) {\n            return {\n                success: false,\n                error: 'App not configured. Please run setup first.'\n            };\n        }\n\n        try {\n            const response = await this.msalInstance.loginPopup({\n                scopes: graphScopes.all,\n                prompt: \"select_account\"\n            });\n            this.account = response.account;\n            return {\n                success: true,\n                account: this.account\n            };\n        } catch (error) {\n            console.error('Login failed:', error);\n            return {\n                success: false,\n                error: this.getFriendlyError(error)\n            };\n        }\n    }\n\n    /**\n     * Login with redirect (alternative to popup)\n     */\n    async loginRedirect() {\n        if (!this.msalInstance) {\n            throw new Error('App not configured');\n        }\n\n        try {\n            await this.msalInstance.loginRedirect({\n                scopes: graphScopes.all\n            });\n        } catch (error) {\n            console.error('Login redirect failed:', error);\n            throw error;\n        }\n    }\n\n    /**\n     * Logout\n     */\n    async logout() {\n        if (!this.msalInstance) {\n            this.account = null;\n            return { success: true };\n        }\n\n        try {\n            await this.msalInstance.logoutPopup({\n                account: this.account,\n                postLogoutRedirectUri: window.location.origin\n            });\n            this.account = null;\n            return { success: true };\n        } catch (error) {\n            console.error('Logout failed:', error);\n            return {\n                success: false,\n                error: this.getFriendlyError(error)\n            };\n        }\n    }\n\n    /**\n     * Get access token for API calls\n     */\n    async getAccessToken(scopes = graphScopes.all) {\n        if (!this.account) {\n            throw new Error('No account found. Please login first.');\n        }\n\n        const tokenRequest = {\n            scopes: scopes,\n            account: this.account\n        };\n\n        try {\n            // Try silent token acquisition first\n            const response = await this.msalInstance.acquireTokenSilent(tokenRequest);\n            return response.accessToken;\n        } catch (error) {\n            if (error instanceof InteractionRequiredAuthError) {\n                // Silent acquisition failed, need interaction\n                try {\n                    const response = await this.msalInstance.acquireTokenPopup(tokenRequest);\n                    return response.accessToken;\n                } catch (popupError) {\n                    console.error('Token acquisition failed:', popupError);\n                    throw popupError;\n                }\n            }\n            throw error;\n        }\n    }\n\n    /**\n     * Convert error to user-friendly message\n     */\n    getFriendlyError(error) {\n        const errorMessage = error.message || error.toString();\n\n        if (errorMessage.includes('user_cancelled')) {\n            return 'Login was cancelled.';\n        }\n        if (errorMessage.includes('consent_required')) {\n            return 'Admin consent is required for this application.';\n        }\n        if (errorMessage.includes('interaction_required')) {\n            return 'Please sign in again.';\n        }\n        if (errorMessage.includes('invalid_client')) {\n            return 'Application configuration error. Please check client ID.';\n        }\n        if (errorMessage.includes('unauthorized_client')) {\n            return 'This application is not authorized in your tenant.';\n        }\n        if (errorMessage.includes('AADSTS700016')) {\n            return 'Application not found. You may need to run setup again.';\n        }\n\n        return errorMessage;\n    }\n}\n\n// Export singleton instance\nexport const authService = new AuthService();\n","/**\n * Microsoft Graph API Service\n * Handles all Graph API calls for PIM operations\n */\n\nimport { authService } from './authService.js';\nimport { graphEndpoints, graphScopes } from '../config/authConfig.js';\nimport { SecurityUtils, rateLimiter } from '../utils/security.js';\n\nclass GraphService {\n    constructor() {\n        this.baseUrl = 'https://graph.microsoft.com/v1.0';\n        this.betaUrl = 'https://graph.microsoft.com/beta';\n    }\n\n    /**\n     * Make an authenticated Graph API request (with rate limiting)\n     */\n    async request(endpoint, options = {}) {\n        // Determine rate limit type\n        const method = options.method || 'GET';\n        const rateLimitType = method === 'GET'\n            ? (endpoint.includes('$filter') || endpoint.includes('$search') ? 'search' : 'default')\n            : 'mutation';\n\n        // Check rate limit\n        if (!rateLimiter.isAllowed(endpoint, rateLimitType)) {\n            const resetTime = rateLimiter.getResetTime(endpoint, rateLimitType);\n            const error = new Error(`Rate limit exceeded. Try again in ${resetTime} seconds.`);\n            error.code = 'RATE_LIMIT_EXCEEDED';\n            error.resetTime = resetTime;\n            throw error;\n        }\n\n        const token = await authService.getAccessToken();\n\n        const defaultHeaders = {\n            'Authorization': `Bearer ${token}`,\n            'Content-Type': 'application/json'\n        };\n\n        const response = await fetch(endpoint, {\n            ...options,\n            headers: {\n                ...defaultHeaders,\n                ...options.headers\n            }\n        });\n\n        if (!response.ok) {\n            const errorBody = await response.json().catch(() => ({}));\n            const error = new Error(errorBody.error?.message || `HTTP ${response.status}`);\n            error.status = response.status;\n            error.code = errorBody.error?.code;\n            throw error;\n        }\n\n        // Handle 204 No Content\n        if (response.status === 204) {\n            return null;\n        }\n\n        return response.json();\n    }\n\n    /**\n     * GET request helper\n     */\n    async get(endpoint) {\n        return this.request(endpoint, { method: 'GET' });\n    }\n\n    /**\n     * GET request with custom headers\n     */\n    async getWithCustomHeaders(endpoint, customHeaders = {}) {\n        return this.request(endpoint, {\n            method: 'GET',\n            headers: customHeaders\n        });\n    }\n\n    /**\n     * POST request helper\n     */\n    async post(endpoint, body) {\n        return this.request(endpoint, {\n            method: 'POST',\n            body: JSON.stringify(body)\n        });\n    }\n\n    /**\n     * PATCH request helper\n     */\n    async patch(endpoint, body) {\n        return this.request(endpoint, {\n            method: 'PATCH',\n            body: JSON.stringify(body)\n        });\n    }\n\n    /**\n     * DELETE request helper\n     */\n    async delete(endpoint) {\n        return this.request(endpoint, { method: 'DELETE' });\n    }\n\n    /**\n     * Batch request helper - sends multiple requests in a single HTTP call\n     * Graph API limits: max 20 requests per batch\n     * @param {Array} requests - Array of request objects { id, method, url, headers }\n     * @returns {Object} Map of id -> response\n     */\n    async batch(requests) {\n        if (!requests || requests.length === 0) {\n            return {};\n        }\n\n        // Graph API batch limit is 20 requests per batch\n        const BATCH_SIZE = 20;\n        const chunks = this.chunkArray(requests, BATCH_SIZE);\n        const allResponses = {};\n\n        for (const chunk of chunks) {\n            try {\n                const batchPayload = {\n                    requests: chunk.map((req, index) => ({\n                        id: req.id || `${index}`,\n                        method: req.method || 'GET',\n                        url: req.url,\n                        headers: req.headers || {}\n                    }))\n                };\n\n                const response = await this.post(`${this.baseUrl}/$batch`, batchPayload);\n\n                // Parse batch responses\n                if (response && response.responses) {\n                    response.responses.forEach(batchResponse => {\n                        allResponses[batchResponse.id] = {\n                            status: batchResponse.status,\n                            body: batchResponse.body\n                        };\n                    });\n                }\n            } catch (error) {\n                console.error('Batch request failed:', error);\n                // Mark all requests in this chunk as failed\n                chunk.forEach(req => {\n                    allResponses[req.id] = {\n                        status: 500,\n                        body: { error: { message: error.message } }\n                    };\n                });\n            }\n        }\n\n        return allResponses;\n    }\n\n    /**\n     * Helper: chunk an array into smaller arrays\n     * @param {Array} array - Array to chunk\n     * @param {number} size - Chunk size\n     * @returns {Array} Array of chunks\n     */\n    chunkArray(array, size) {\n        const chunks = [];\n        for (let i = 0; i < array.length; i += size) {\n            chunks.push(array.slice(i, i + size));\n        }\n        return chunks;\n    }\n\n    // ==========================================\n    // User Operations\n    // ==========================================\n\n    /**\n     * Get current user profile\n     */\n    async getMe() {\n        return this.get(`${this.baseUrl}/me`);\n    }\n\n    // ==========================================\n    // Group Operations\n    // ==========================================\n\n    /**\n     * Get all role-assignable groups (PIM-eligible)\n     */\n    async getPIMGroups() {\n        try {\n            // Step 1: Fetch all PIM groups\n            const response = await this.get(\n                `${this.baseUrl}/groups?$filter=isAssignableToRole eq true&$select=id,displayName,description,createdDateTime,mailNickname`\n            );\n\n            const groups = response.value || [];\n\n            if (groups.length === 0) {\n                return { success: true, groups: [], count: 0 };\n            }\n\n            // Step 2: Build batch requests for member and owner counts\n            // Using Graph batch API to reduce 200 requests to ~10 batch requests\n            const batchRequests = [];\n\n            groups.forEach((group, index) => {\n                // Request for member count\n                batchRequests.push({\n                    id: `${index}-members`,\n                    method: 'GET',\n                    url: `/groups/${group.id}/members/$count`,\n                    headers: { 'ConsistencyLevel': 'eventual' }\n                });\n\n                // Request for owner count\n                batchRequests.push({\n                    id: `${index}-owners`,\n                    method: 'GET',\n                    url: `/groups/${group.id}/owners/$count`,\n                    headers: { 'ConsistencyLevel': 'eventual' }\n                });\n            });\n\n            // Step 3: Execute batch requests\n            const batchResponses = await this.batch(batchRequests);\n\n            // Step 4: Map counts back to groups\n            const groupsWithCounts = groups.map((group, index) => {\n                const memberResponse = batchResponses[`${index}-members`];\n                const ownerResponse = batchResponses[`${index}-owners`];\n\n                const memberCount = (memberResponse?.status === 200 && typeof memberResponse.body === 'number')\n                    ? memberResponse.body\n                    : 0;\n\n                const ownerCount = (ownerResponse?.status === 200 && typeof ownerResponse.body === 'number')\n                    ? ownerResponse.body\n                    : 0;\n\n                return {\n                    ...group,\n                    memberCount,\n                    ownerCount\n                };\n            });\n\n            return {\n                success: true,\n                groups: groupsWithCounts,\n                count: groupsWithCounts.length\n            };\n        } catch (error) {\n            console.error('Failed to fetch PIM groups:', error);\n            return {\n                success: false,\n                error: this.getFriendlyError(error),\n                groups: []\n            };\n        }\n    }\n\n    /**\n     * Get PIM groups with server-side pagination\n     * @param {number} pageNumber - Page number (1-based)\n     * @param {number} pageSize - Number of items per page\n     * @returns {Object} Paginated result with items, totalCount, pageNumber, pageSize, totalPages\n     */\n    async getGroupsPage(pageNumber = 1, pageSize = 50) {\n        try {\n            const skip = (pageNumber - 1) * pageSize;\n\n            // Fetch groups with pagination and total count\n            const response = await this.getWithCustomHeaders(\n                `${this.baseUrl}/groups?` +\n                `$filter=isAssignableToRole eq true&` +\n                `$select=id,displayName,description,createdDateTime,mailNickname&` +\n                `$top=${pageSize}&` +\n                `$skip=${skip}&` +\n                `$count=true`,\n                { 'ConsistencyLevel': 'eventual' }\n            );\n\n            const groups = response.value || [];\n            const totalCount = response['@odata.count'] || 0;\n\n            if (groups.length === 0) {\n                return {\n                    success: true,\n                    items: [],\n                    totalCount: 0,\n                    pageNumber,\n                    pageSize,\n                    totalPages: 0\n                };\n            }\n\n            // Build batch requests for member and owner counts\n            const batchRequests = [];\n\n            groups.forEach((group, index) => {\n                batchRequests.push({\n                    id: `${index}-members`,\n                    method: 'GET',\n                    url: `/groups/${group.id}/members/$count`,\n                    headers: { 'ConsistencyLevel': 'eventual' }\n                });\n\n                batchRequests.push({\n                    id: `${index}-owners`,\n                    method: 'GET',\n                    url: `/groups/${group.id}/owners/$count`,\n                    headers: { 'ConsistencyLevel': 'eventual' }\n                });\n            });\n\n            // Execute batch requests\n            const batchResponses = await this.batch(batchRequests);\n\n            // Map counts back to groups\n            const groupsWithCounts = groups.map((group, index) => {\n                const memberResponse = batchResponses[`${index}-members`];\n                const ownerResponse = batchResponses[`${index}-owners`];\n\n                const memberCount = (memberResponse?.status === 200 && typeof memberResponse.body === 'number')\n                    ? memberResponse.body\n                    : 0;\n\n                const ownerCount = (ownerResponse?.status === 200 && typeof ownerResponse.body === 'number')\n                    ? ownerResponse.body\n                    : 0;\n\n                return {\n                    ...group,\n                    memberCount,\n                    ownerCount\n                };\n            });\n\n            return {\n                success: true,\n                items: groupsWithCounts,\n                totalCount,\n                pageNumber,\n                pageSize,\n                totalPages: Math.ceil(totalCount / pageSize)\n            };\n        } catch (error) {\n            console.error('Failed to fetch groups page:', error);\n            return {\n                success: false,\n                error: this.getFriendlyError(error),\n                items: [],\n                totalCount: 0,\n                pageNumber,\n                pageSize,\n                totalPages: 0\n            };\n        }\n    }\n\n    /**\n     * Create a new PIM group\n     */\n    async createPIMGroup(displayName, description, mailNickname) {\n        try {\n            const group = await this.post(`${this.baseUrl}/groups`, {\n                displayName,\n                description,\n                mailNickname: mailNickname || displayName.replace(/[^a-zA-Z0-9]/g, ''),\n                mailEnabled: false,\n                securityEnabled: true,\n                isAssignableToRole: true,\n                groupTypes: []\n            });\n\n            return {\n                success: true,\n                group\n            };\n        } catch (error) {\n            console.error('Failed to create group:', error);\n            return {\n                success: false,\n                error: this.getFriendlyError(error)\n            };\n        }\n    }\n\n    /**\n     * Delete a group\n     */\n    async deleteGroup(groupId) {\n        try {\n            await this.delete(`${this.baseUrl}/groups/${groupId}`);\n            return { success: true };\n        } catch (error) {\n            return {\n                success: false,\n                error: this.getFriendlyError(error)\n            };\n        }\n    }\n\n    /**\n     * Get group members\n     */\n    async getGroupMembers(groupId) {\n        try {\n            const response = await this.get(\n                `${this.baseUrl}/groups/${groupId}/members?$select=id,displayName,userPrincipalName,mail`\n            );\n            return {\n                success: true,\n                members: response.value || []\n            };\n        } catch (error) {\n            return {\n                success: false,\n                error: this.getFriendlyError(error),\n                members: []\n            };\n        }\n    }\n\n    /**\n     * Add a member to a group\n     */\n    async addGroupMember(groupId, userId) {\n        try {\n            await this.post(`${this.baseUrl}/groups/${groupId}/members/$ref`, {\n                '@odata.id': `https://graph.microsoft.com/v1.0/directoryObjects/${userId}`\n            });\n            return { success: true };\n        } catch (error) {\n            return {\n                success: false,\n                error: this.getFriendlyError(error)\n            };\n        }\n    }\n\n    /**\n     * Remove a member from a group\n     */\n    async removeGroupMember(groupId, userId) {\n        try {\n            await this.delete(`${this.baseUrl}/groups/${groupId}/members/${userId}/$ref`);\n            return { success: true };\n        } catch (error) {\n            return {\n                success: false,\n                error: this.getFriendlyError(error)\n            };\n        }\n    }\n\n    // ==========================================\n    // PIM Policy Operations\n    // ==========================================\n\n    /**\n     * Get PIM policy for a group\n     */\n    async getGroupPolicy(groupId, accessId = 'member') {\n        try {\n            // Get the policy assignment for this group\n            const policiesResponse = await this.get(\n                `${this.baseUrl}/policies/roleManagementPolicyAssignments?$filter=scopeId eq '${groupId}' and scopeType eq 'Group' and roleDefinitionId eq '${accessId}'`\n            );\n\n            if (!policiesResponse.value || policiesResponse.value.length === 0) {\n                return {\n                    success: false,\n                    error: 'No PIM policy found for this group',\n                    isDefault: true\n                };\n            }\n\n            const policyAssignment = policiesResponse.value[0];\n            const policyId = policyAssignment.policyId;\n\n            // Get the policy rules\n            const rulesResponse = await this.get(\n                `${this.baseUrl}/policies/roleManagementPolicies/${policyId}/rules`\n            );\n\n            const rules = rulesResponse.value || [];\n            const settings = this.parseRulesToSettings(rules);\n\n            return {\n                success: true,\n                policyId,\n                settings,\n                rawRules: rules\n            };\n        } catch (error) {\n            // Check if this is a permission error for PIM for Groups\n            if (error.status === 403 && error.message?.includes('RoleManagementPolicy')) {\n                // Silently handle - PIM for Groups requires additional permissions\n                return {\n                    success: false,\n                    error: 'PIM for Groups not configured (requires additional permissions)',\n                    requiresPermissions: true,\n                    missingPermissions: ['RoleManagementPolicy.Read.AzureADGroup']\n                };\n            }\n\n            console.error('Failed to get group policy:', error);\n            return {\n                success: false,\n                error: this.getFriendlyError(error)\n            };\n        }\n    }\n\n    /**\n     * Update PIM policy settings for a group\n     * Uses beta endpoint for writes as v1.0 has limited support\n     */\n    async updateGroupPolicy(groupId, accessId, settings) {\n        try {\n            // First get the current policy\n            const policyResult = await this.getGroupPolicy(groupId, accessId);\n            if (!policyResult.success) {\n                return policyResult;\n            }\n\n            const { policyId, rawRules } = policyResult;\n            const updates = [];\n\n            // Find and update relevant rules\n            for (const rule of rawRules) {\n                const ruleType = rule['@odata.type'];\n                const ruleId = rule.id;\n\n                // Update expiration rule (activation duration)\n                if (ruleType === '#microsoft.graph.unifiedRoleManagementPolicyExpirationRule' &&\n                    rule.target?.caller === 'EndUser') {\n                    if (settings.maximumDurationHours !== undefined) {\n                        updates.push(this.patch(\n                            `${this.betaUrl}/policies/roleManagementPolicies/${policyId}/rules/${ruleId}`,\n                            {\n                                '@odata.type': ruleType,\n                                id: ruleId,\n                                isExpirationRequired: true,\n                                maximumDuration: `PT${settings.maximumDurationHours}H`,\n                                target: rule.target\n                            }\n                        ));\n                    }\n                }\n\n                // Update enablement rule (MFA, justification)\n                if (ruleType === '#microsoft.graph.unifiedRoleManagementPolicyEnablementRule' &&\n                    rule.target?.caller === 'EndUser') {\n                    const enabledRules = [];\n                    if (settings.requireMfa) enabledRules.push('MultiFactorAuthentication');\n                    if (settings.requireJustification) enabledRules.push('Justification');\n                    if (settings.requireTicketInfo) enabledRules.push('Ticketing');\n\n                    updates.push(this.patch(\n                        `${this.betaUrl}/policies/roleManagementPolicies/${policyId}/rules/${ruleId}`,\n                        {\n                            '@odata.type': ruleType,\n                            id: ruleId,\n                            enabledRules,\n                            target: rule.target\n                        }\n                    ));\n                }\n\n                // Update approval rule\n                if (ruleType === '#microsoft.graph.unifiedRoleManagementPolicyApprovalRule') {\n                    if (settings.requireApproval !== undefined) {\n                        updates.push(this.patch(\n                            `${this.betaUrl}/policies/roleManagementPolicies/${policyId}/rules/${ruleId}`,\n                            {\n                                '@odata.type': ruleType,\n                                id: ruleId,\n                                setting: {\n                                    isApprovalRequired: settings.requireApproval,\n                                    isApprovalRequiredForExtension: false,\n                                    isRequestorJustificationRequired: true,\n                                    approvalMode: 'SingleStage',\n                                    approvalStages: settings.approverIds && settings.approverIds.length > 0 ? [{\n                                        approvalStageTimeOutInDays: 1,\n                                        isApproverJustificationRequired: true,\n                                        escalationTimeInMinutes: 0,\n                                        isEscalationEnabled: false,\n                                        primaryApprovers: settings.approverIds.map(userId => ({\n                                            '@odata.type': '#microsoft.graph.singleUser',\n                                            userId: userId\n                                        }))\n                                    }] : []\n                                },\n                                target: rule.target\n                            }\n                        ));\n                    }\n                }\n            }\n\n            // Execute all updates in parallel\n            await Promise.all(updates);\n\n            return {\n                success: true,\n                updatedRules: updates.length\n            };\n        } catch (error) {\n            console.error('Failed to update group policy:', error);\n            return {\n                success: false,\n                error: this.getFriendlyError(error)\n            };\n        }\n    }\n\n    /**\n     * Parse policy rules into a settings object\n     */\n    parseRulesToSettings(rules) {\n        const settings = {\n            activation: {\n                maximumDurationHours: 8,\n                requireMfa: true,\n                requireJustification: true,\n                requireTicketInfo: false,\n                requireApproval: false,\n                approvers: []\n            },\n            eligibleAssignment: {\n                allowPermanent: true,\n                maximumDurationDays: 365\n            },\n            activeAssignment: {\n                allowPermanent: false,\n                maximumDurationDays: 30,\n                requireMfa: true,\n                requireJustification: true\n            }\n        };\n\n        for (const rule of rules) {\n            const ruleType = rule['@odata.type'];\n            const target = rule.target || {};\n\n            // Expiration rules\n            if (ruleType === '#microsoft.graph.unifiedRoleManagementPolicyExpirationRule') {\n                const duration = rule.maximumDuration || 'PT8H';\n                const hours = this.parseIsoDuration(duration);\n\n                if (target.caller === 'EndUser') {\n                    settings.activation.maximumDurationHours = hours;\n                } else if (target.caller === 'Admin' && target.level === 'Eligibility') {\n                    settings.eligibleAssignment.allowPermanent = !rule.isExpirationRequired;\n                    settings.eligibleAssignment.maximumDurationDays = this.parseIsoDurationDays(duration);\n                } else if (target.caller === 'Admin' && target.level === 'Assignment') {\n                    settings.activeAssignment.allowPermanent = !rule.isExpirationRequired;\n                    settings.activeAssignment.maximumDurationDays = this.parseIsoDurationDays(duration);\n                }\n            }\n\n            // Enablement rules\n            if (ruleType === '#microsoft.graph.unifiedRoleManagementPolicyEnablementRule') {\n                const enabled = rule.enabledRules || [];\n                if (target.caller === 'EndUser') {\n                    settings.activation.requireMfa = enabled.includes('MultiFactorAuthentication');\n                    settings.activation.requireJustification = enabled.includes('Justification');\n                    settings.activation.requireTicketInfo = enabled.includes('Ticketing');\n                }\n            }\n\n            // Approval rules\n            if (ruleType === '#microsoft.graph.unifiedRoleManagementPolicyApprovalRule') {\n                const approvalSetting = rule.setting || {};\n                settings.activation.requireApproval = approvalSetting.isApprovalRequired || false;\n\n                if (approvalSetting.approvalStages?.[0]?.primaryApprovers) {\n                    settings.activation.approvers = approvalSetting.approvalStages[0].primaryApprovers\n                        .filter(a => a.userId)\n                        .map(a => a.userId);\n                }\n            }\n        }\n\n        return settings;\n    }\n\n    /**\n     * Parse ISO 8601 duration to hours\n     */\n    parseIsoDuration(duration) {\n        const match = duration.match(/PT(\\d+)H/);\n        return match ? parseInt(match[1]) : 8;\n    }\n\n    /**\n     * Parse ISO 8601 duration to days\n     */\n    parseIsoDurationDays(duration) {\n        const dayMatch = duration.match(/P(\\d+)D/);\n        if (dayMatch) return parseInt(dayMatch[1]);\n\n        const hourMatch = duration.match(/PT(\\d+)H/);\n        if (hourMatch) return Math.ceil(parseInt(hourMatch[1]) / 24);\n\n        return 365;\n    }\n\n    // ==========================================\n    // Role Operations\n    // ==========================================\n\n    /**\n     * Get all Entra ID role definitions\n     */\n    // Privilege level classification for Entra ID roles\n    static PRIVILEGE_LEVELS = {\n        critical: [\n            '62e90394-69f5-4237-9190-012177145e10', // Global Administrator\n            'e8611ab8-c189-46e8-94e1-60213ab1f814', // Privileged Role Administrator\n            '194ae4cb-b126-40b2-bd5b-6091b380977d', // Security Administrator\n            '9b895d92-2cd3-44c7-9d02-a6ac2d5ea5c3', // Application Administrator\n            '158c047a-c907-4556-b7ef-446551a6b5f7', // Cloud Application Administrator\n            '29232cdf-9323-42fd-ade2-1d097af3e4de', // Exchange Administrator\n            'f28a1f50-f6e7-4571-818b-6a12f2af6b6c', // SharePoint Administrator\n            'fe930be7-5e62-47db-91af-98c3a49a38b1', // User Administrator\n        ],\n        high: [\n            '7be44c8a-adaf-4e2a-84d6-ab2649e08a13', // Privileged Authentication Administrator\n            'c4e39bd9-1100-46d3-8c65-fb160da0071f', // Authentication Administrator\n            'b1be1c3e-b65d-4f19-8427-f6fa0d97feb9', // Conditional Access Administrator\n            '729827e3-9c14-49f7-bb1b-9608f156bbb8', // Helpdesk Administrator\n            'b0f54661-2d74-4c50-afa3-1ec803f12efe', // Billing Administrator\n            '966707d0-3269-4727-9be2-8c3a10f19b9d', // Password Administrator\n            'fdd7a751-b60b-444a-984c-02652fe8fa1c', // Groups Administrator\n            '3a2c62db-5318-420d-8d74-23affee5d9d5', // Intune Administrator\n            '11648597-926c-4cf3-9c36-bcebb0ba8dcc', // Power Platform Administrator\n        ],\n        medium: [\n            '44367163-eba1-44c3-98af-f5787879f96a', // Dynamics 365 Administrator\n            '3d762c5a-1b6c-493f-843e-55a3b42923d4', // Teams Administrator\n            '112f9467-49fe-4fc5-9abe-d52302e4f8c1', // Insights Administrator\n            '31392ffb-586c-42d1-9346-e59415a2cc4e', // Exchange Recipient Administrator\n            '892c5842-a9a6-463a-8041-72aa08ca3cf6', // Cloud Device Administrator\n            '17315797-102d-40b4-93e0-432062caca18', // Compliance Administrator\n            'd29b2b05-8046-44ba-8758-1e26182fcf32', // Directory Synchronization Accounts\n        ],\n        // All other roles are considered 'low' privilege\n    };\n\n    /**\n     * Get privilege level for a role based on its templateId\n     */\n    getRolePrivilegeLevel(templateId) {\n        if (GraphService.PRIVILEGE_LEVELS.critical.includes(templateId)) return 'critical';\n        if (GraphService.PRIVILEGE_LEVELS.high.includes(templateId)) return 'high';\n        if (GraphService.PRIVILEGE_LEVELS.medium.includes(templateId)) return 'medium';\n        return 'low';\n    }\n\n    async getRoleDefinitions() {\n        try {\n            const response = await this.get(\n                `${this.baseUrl}/roleManagement/directory/roleDefinitions?$select=id,displayName,description,isBuiltIn,templateId`\n            );\n\n            // Add privilege level to each role\n            const roles = (response.value || []).map(role => ({\n                ...role,\n                privilegeLevel: this.getRolePrivilegeLevel(role.templateId || role.id)\n            }));\n\n            return {\n                success: true,\n                roles\n            };\n        } catch (error) {\n            return {\n                success: false,\n                error: this.getFriendlyError(error),\n                roles: []\n            };\n        }\n    }\n\n    /**\n     * Get role definitions with server-side pagination\n     * @param {number} pageNumber - Page number (1-based)\n     * @param {number} pageSize - Number of items per page\n     * @returns {Object} Paginated result with items, totalCount, pageNumber, pageSize, totalPages\n     */\n    async getRolesPage(pageNumber = 1, pageSize = 50) {\n        try {\n            const skip = (pageNumber - 1) * pageSize;\n\n            const response = await this.getWithCustomHeaders(\n                `${this.baseUrl}/roleManagement/directory/roleDefinitions?` +\n                `$select=id,displayName,description,isBuiltIn,templateId&` +\n                `$top=${pageSize}&` +\n                `$skip=${skip}&` +\n                `$count=true`,\n                { 'ConsistencyLevel': 'eventual' }\n            );\n\n            const totalCount = response['@odata.count'] || 0;\n\n            // Add privilege level to each role\n            const roles = (response.value || []).map(role => ({\n                ...role,\n                privilegeLevel: this.getRolePrivilegeLevel(role.templateId || role.id)\n            }));\n\n            return {\n                success: true,\n                items: roles,\n                totalCount,\n                pageNumber,\n                pageSize,\n                totalPages: Math.ceil(totalCount / pageSize)\n            };\n        } catch (error) {\n            return {\n                success: false,\n                error: this.getFriendlyError(error),\n                items: [],\n                totalCount: 0,\n                pageNumber,\n                pageSize,\n                totalPages: 0\n            };\n        }\n    }\n\n    /**\n     * Get role policy\n     */\n    async getRolePolicy(roleDefinitionId) {\n        try {\n            const policiesResponse = await this.get(\n                `${this.baseUrl}/policies/roleManagementPolicyAssignments?$filter=scopeId eq '/' and scopeType eq 'DirectoryRole' and roleDefinitionId eq '${roleDefinitionId}'`\n            );\n\n            if (!policiesResponse.value || policiesResponse.value.length === 0) {\n                return {\n                    success: false,\n                    error: 'No policy found for this role'\n                };\n            }\n\n            const policyAssignment = policiesResponse.value[0];\n            const policyId = policyAssignment.policyId;\n\n            const rulesResponse = await this.get(\n                `${this.baseUrl}/policies/roleManagementPolicies/${policyId}/rules`\n            );\n\n            const rules = rulesResponse.value || [];\n            const settings = this.parseRulesToSettings(rules);\n\n            return {\n                success: true,\n                policyId,\n                settings,\n                rawRules: rules\n            };\n        } catch (error) {\n            return {\n                success: false,\n                error: this.getFriendlyError(error)\n            };\n        }\n    }\n\n    /**\n     * Convert email addresses to user IDs\n     * @param {Array<string>} emails - Array of email addresses\n     * @returns {Promise<Array<string>>} Array of user IDs\n     */\n    async getUserIdsByEmails(emails) {\n        if (!emails || emails.length === 0) {\n            return [];\n        }\n\n        try {\n            const userIds = [];\n\n            for (const email of emails) {\n                try {\n                    const response = await this.get(\n                        `${this.baseUrl}/users/${encodeURIComponent(email)}?$select=id`\n                    );\n                    userIds.push(response.id);\n                } catch (error) {\n                    console.warn(`Failed to find user ID for ${email}:`, error.message);\n                    // Skip this email if user not found\n                }\n            }\n\n            return userIds;\n        } catch (error) {\n            console.error('Failed to convert emails to user IDs:', error);\n            return [];\n        }\n    }\n\n    /**\n     * Update PIM policy settings for a role\n     * Uses beta endpoint for writes as v1.0 has limited support\n     */\n    async updateRolePolicy(roleDefinitionId, settings) {\n        try {\n            // First get the current policy\n            const policyResult = await this.getRolePolicy(roleDefinitionId);\n            if (!policyResult.success) {\n                return policyResult;\n            }\n\n            const { policyId, rawRules } = policyResult;\n            const updates = [];\n\n            // Convert approver emails to user IDs if provided\n            if (settings.approvers && settings.approvers.length > 0) {\n                settings.approverIds = await this.getUserIdsByEmails(settings.approvers);\n                if (settings.approverIds.length === 0) {\n                    return {\n                        success: false,\n                        error: 'Could not find any of the specified approvers. Please check the email addresses.'\n                    };\n                }\n            }\n\n            // Find and update relevant rules\n            for (const rule of rawRules) {\n                const ruleType = rule['@odata.type'];\n                const ruleId = rule.id;\n\n                // Update expiration rule (activation duration)\n                if (ruleType === '#microsoft.graph.unifiedRoleManagementPolicyExpirationRule' &&\n                    rule.target?.caller === 'EndUser') {\n                    if (settings.maximumDurationHours !== undefined) {\n                        updates.push(this.patch(\n                            `${this.betaUrl}/policies/roleManagementPolicies/${policyId}/rules/${ruleId}`,\n                            {\n                                '@odata.type': ruleType,\n                                id: ruleId,\n                                isExpirationRequired: true,\n                                maximumDuration: `PT${settings.maximumDurationHours}H`,\n                                target: rule.target\n                            }\n                        ));\n                    }\n                }\n\n                // Update enablement rule (MFA, justification)\n                if (ruleType === '#microsoft.graph.unifiedRoleManagementPolicyEnablementRule' &&\n                    rule.target?.caller === 'EndUser') {\n                    const enabledRules = [];\n                    if (settings.requireMfa) enabledRules.push('MultiFactorAuthentication');\n                    if (settings.requireJustification) enabledRules.push('Justification');\n                    if (settings.requireTicketInfo) enabledRules.push('Ticketing');\n\n                    updates.push(this.patch(\n                        `${this.betaUrl}/policies/roleManagementPolicies/${policyId}/rules/${ruleId}`,\n                        {\n                            '@odata.type': ruleType,\n                            id: ruleId,\n                            enabledRules,\n                            target: rule.target\n                        }\n                    ));\n                }\n\n                // Update approval rule\n                if (ruleType === '#microsoft.graph.unifiedRoleManagementPolicyApprovalRule') {\n                    if (settings.requireApproval !== undefined) {\n                        updates.push(this.patch(\n                            `${this.betaUrl}/policies/roleManagementPolicies/${policyId}/rules/${ruleId}`,\n                            {\n                                '@odata.type': ruleType,\n                                id: ruleId,\n                                setting: {\n                                    isApprovalRequired: settings.requireApproval,\n                                    isApprovalRequiredForExtension: false,\n                                    isRequestorJustificationRequired: true,\n                                    approvalMode: 'SingleStage',\n                                    approvalStages: settings.approverIds && settings.approverIds.length > 0 ? [{\n                                        approvalStageTimeOutInDays: 1,\n                                        isApproverJustificationRequired: true,\n                                        escalationTimeInMinutes: 0,\n                                        isEscalationEnabled: false,\n                                        primaryApprovers: settings.approverIds.map(userId => ({\n                                            '@odata.type': '#microsoft.graph.singleUser',\n                                            userId: userId\n                                        }))\n                                    }] : []\n                                },\n                                target: rule.target\n                            }\n                        ));\n                    }\n                }\n            }\n\n            // Execute all updates in parallel\n            await Promise.all(updates);\n\n            return {\n                success: true,\n                updatedRules: updates.length\n            };\n        } catch (error) {\n            console.error('Failed to update role policy:', error);\n            return {\n                success: false,\n                error: this.getFriendlyError(error)\n            };\n        }\n    }\n\n    // ==========================================\n    // Assignment Operations\n    // ==========================================\n\n    /**\n     * Get eligible assignments for a group\n     */\n    async getGroupEligibleAssignments(groupId) {\n        try {\n            const response = await this.get(\n                `${this.baseUrl}/identityGovernance/privilegedAccess/group/eligibilityScheduleInstances?$filter=groupId eq '${groupId}'&$expand=principal`\n            );\n            return {\n                success: true,\n                assignments: response.value || []\n            };\n        } catch (error) {\n            return {\n                success: false,\n                error: this.getFriendlyError(error),\n                assignments: []\n            };\n        }\n    }\n\n    /**\n     * Get active assignments for a group\n     */\n    async getGroupActiveAssignments(groupId) {\n        try {\n            const response = await this.get(\n                `${this.baseUrl}/identityGovernance/privilegedAccess/group/assignmentScheduleInstances?$filter=groupId eq '${groupId}'&$expand=principal`\n            );\n            return {\n                success: true,\n                assignments: response.value || []\n            };\n        } catch (error) {\n            return {\n                success: false,\n                error: this.getFriendlyError(error),\n                assignments: []\n            };\n        }\n    }\n\n    /**\n     * Get all assignments for multiple groups (for PIMMaid)\n     */\n    async getAllGroupAssignments(groups) {\n        const assignments = {};\n\n        for (const group of groups) {\n            try {\n                const [eligible, active] = await Promise.all([\n                    this.getGroupEligibleAssignments(group.id),\n                    this.getGroupActiveAssignments(group.id)\n                ]);\n\n                const eligibleUsers = (eligible.assignments || [])\n                    .filter(a => a.principalId)\n                    .map(a => ({\n                        id: a.principalId,\n                        displayName: a.principal?.displayName || 'Unknown User',\n                        accessId: a.accessId\n                    }));\n\n                const activeUsers = (active.assignments || [])\n                    .filter(a => a.principalId)\n                    .map(a => ({\n                        id: a.principalId,\n                        displayName: a.principal?.displayName || 'Unknown User',\n                        accessId: a.accessId\n                    }));\n\n                if (eligibleUsers.length > 0 || activeUsers.length > 0) {\n                    assignments[group.id] = {\n                        eligible: eligibleUsers,\n                        active: activeUsers\n                    };\n                }\n            } catch (error) {\n                console.warn(`Failed to get assignments for group ${group.id}:`, error);\n            }\n        }\n\n        return { success: true, assignments };\n    }\n\n    /**\n     * Get role eligibility assignments\n     */\n    async getRoleEligibilityAssignments() {\n        try {\n            const response = await this.get(\n                `${this.baseUrl}/roleManagement/directory/roleEligibilityScheduleInstances?$expand=principal`\n            );\n            return {\n                success: true,\n                assignments: response.value || []\n            };\n        } catch (error) {\n            return {\n                success: false,\n                error: this.getFriendlyError(error),\n                assignments: []\n            };\n        }\n    }\n\n    /**\n     * Get role active assignments\n     */\n    async getRoleActiveAssignments() {\n        try {\n            const response = await this.get(\n                `${this.baseUrl}/roleManagement/directory/roleAssignmentScheduleInstances?$expand=principal`\n            );\n            return {\n                success: true,\n                assignments: response.value || []\n            };\n        } catch (error) {\n            return {\n                success: false,\n                error: this.getFriendlyError(error),\n                assignments: []\n            };\n        }\n    }\n\n    /**\n     * Get all role assignments grouped by role (for PIMMaid)\n     */\n    async getAllRoleAssignments() {\n        try {\n            const [eligible, active] = await Promise.all([\n                this.getRoleEligibilityAssignments(),\n                this.getRoleActiveAssignments()\n            ]);\n\n            const assignments = {};\n\n            // Process eligible assignments\n            for (const assignment of (eligible.assignments || [])) {\n                const roleId = assignment.roleDefinitionId;\n                if (!assignments[roleId]) {\n                    assignments[roleId] = [];\n                }\n                assignments[roleId].push({\n                    principalId: assignment.principalId,\n                    principalDisplayName: assignment.principal?.displayName || 'Unknown',\n                    principalType: assignment.principal?.['@odata.type']?.includes('group') ? 'Group' : 'User',\n                    assignmentType: 'Eligible',\n                    startDateTime: assignment.startDateTime,\n                    endDateTime: assignment.endDateTime\n                });\n            }\n\n            // Process active assignments\n            for (const assignment of (active.assignments || [])) {\n                const roleId = assignment.roleDefinitionId;\n                if (!assignments[roleId]) {\n                    assignments[roleId] = [];\n                }\n                assignments[roleId].push({\n                    principalId: assignment.principalId,\n                    principalDisplayName: assignment.principal?.displayName || 'Unknown',\n                    principalType: assignment.principal?.['@odata.type']?.includes('group') ? 'Group' : 'User',\n                    assignmentType: 'Active',\n                    startDateTime: assignment.startDateTime,\n                    endDateTime: assignment.endDateTime\n                });\n            }\n\n            return { success: true, assignments };\n        } catch (error) {\n            return {\n                success: false,\n                error: this.getFriendlyError(error),\n                assignments: {}\n            };\n        }\n    }\n\n    /**\n     * Create eligible assignment for group membership\n     */\n    async createEligibleAssignment(groupId, principalId, accessId, startDateTime, endDateTime) {\n        try {\n            const body = {\n                accessId,\n                principalId,\n                groupId,\n                action: 'adminAssign',\n                scheduleInfo: {\n                    startDateTime: startDateTime || new Date().toISOString(),\n                    expiration: endDateTime ? {\n                        type: 'afterDateTime',\n                        endDateTime\n                    } : {\n                        type: 'noExpiration'\n                    }\n                }\n            };\n\n            const result = await this.post(\n                `${this.baseUrl}/identityGovernance/privilegedAccess/group/eligibilityScheduleRequests`,\n                body\n            );\n\n            return {\n                success: true,\n                assignment: result\n            };\n        } catch (error) {\n            return {\n                success: false,\n                error: this.getFriendlyError(error)\n            };\n        }\n    }\n\n    /**\n     * Create directory role eligibility assignment\n     * Assigns a group/user as eligible for an Entra ID role\n     */\n    async createDirectoryRoleEligibilityAssignment(principalId, roleDefinitionId, justification = 'Baseline deployment', durationMonths = 12) {\n        try {\n            const startDate = new Date();\n            const endDate = new Date();\n            endDate.setMonth(endDate.getMonth() + durationMonths);\n\n            const body = {\n                action: 'adminAssign',\n                justification: justification,\n                roleDefinitionId: roleDefinitionId,\n                directoryScopeId: '/',\n                principalId: principalId,\n                scheduleInfo: {\n                    startDateTime: startDate.toISOString(),\n                    expiration: {\n                        type: 'afterDateTime',\n                        endDateTime: endDate.toISOString()\n                    }\n                }\n            };\n\n            const result = await this.post(\n                `${this.baseUrl}/roleManagement/directory/roleEligibilityScheduleRequests`,\n                body\n            );\n\n            return {\n                success: true,\n                assignment: result\n            };\n        } catch (error) {\n            console.error('Failed to create role eligibility assignment:', error);\n            return {\n                success: false,\n                error: this.getFriendlyError(error)\n            };\n        }\n    }\n\n    /**\n     * Create directory role active assignment\n     * Assigns a group/user as permanently active for an Entra ID role\n     */\n    async createDirectoryRoleActiveAssignment(principalId, roleDefinitionId, justification = 'Baseline deployment - Active assignment') {\n        try {\n            const startDate = new Date();\n\n            const body = {\n                action: 'adminAssign',\n                justification: justification,\n                roleDefinitionId: roleDefinitionId,\n                directoryScopeId: '/',\n                principalId: principalId,\n                scheduleInfo: {\n                    startDateTime: startDate.toISOString(),\n                    expiration: {\n                        type: 'noExpiration'\n                    }\n                }\n            };\n\n            const result = await this.post(\n                `${this.baseUrl}/roleManagement/directory/roleAssignmentScheduleRequests`,\n                body\n            );\n\n            return {\n                success: true,\n                assignment: result\n            };\n        } catch (error) {\n            console.error('Failed to create role active assignment:', error);\n            return {\n                success: false,\n                error: this.getFriendlyError(error)\n            };\n        }\n    }\n\n    /**\n     * Create directory role assignment (flexible - eligible or active, permanent or time-bound)\n     * @param {string} principalId - User or group ID\n     * @param {string} roleDefinitionId - Role definition ID\n     * @param {string} assignmentType - 'eligible' or 'active'\n     * @param {string} justification - Justification text\n     * @param {string} startDateTime - Start date/time (ISO string)\n     * @param {string|null} endDateTime - End date/time (ISO string) or null for permanent\n     */\n    async createDirectoryRoleEligibleAssignment(principalId, roleDefinitionId, justification, startDateTime, endDateTime) {\n        try {\n            const body = {\n                action: 'adminAssign',\n                justification: justification || 'Role assignment',\n                roleDefinitionId: roleDefinitionId,\n                directoryScopeId: '/',\n                principalId: principalId,\n                scheduleInfo: {\n                    startDateTime: startDateTime,\n                    expiration: endDateTime\n                        ? {\n                            type: 'afterDateTime',\n                            endDateTime: endDateTime\n                        }\n                        : {\n                            type: 'noExpiration'\n                        }\n                }\n            };\n\n            const result = await this.post(\n                `${this.baseUrl}/roleManagement/directory/roleEligibilityScheduleRequests`,\n                body\n            );\n\n            return {\n                success: true,\n                assignment: result\n            };\n        } catch (error) {\n            console.error('Failed to create role eligible assignment:', error);\n            return {\n                success: false,\n                error: this.getFriendlyError(error)\n            };\n        }\n    }\n\n    /**\n     * Create directory role active assignment (flexible - permanent or time-bound)\n     * @param {string} principalId - User or group ID\n     * @param {string} roleDefinitionId - Role definition ID\n     * @param {string} justification - Justification text\n     * @param {string} startDateTime - Start date/time (ISO string)\n     * @param {string|null} endDateTime - End date/time (ISO string) or null for permanent\n     */\n    async createDirectoryRoleActiveAssignment(principalId, roleDefinitionId, justification, startDateTime, endDateTime) {\n        try {\n            const body = {\n                action: 'adminAssign',\n                justification: justification || 'Active role assignment',\n                roleDefinitionId: roleDefinitionId,\n                directoryScopeId: '/',\n                principalId: principalId,\n                scheduleInfo: {\n                    startDateTime: startDateTime,\n                    expiration: endDateTime\n                        ? {\n                            type: 'afterDateTime',\n                            endDateTime: endDateTime\n                        }\n                        : {\n                            type: 'noExpiration'\n                        }\n                }\n            };\n\n            const result = await this.post(\n                `${this.baseUrl}/roleManagement/directory/roleAssignmentScheduleRequests`,\n                body\n            );\n\n            return {\n                success: true,\n                assignment: result\n            };\n        } catch (error) {\n            console.error('Failed to create role active assignment:', error);\n            return {\n                success: false,\n                error: this.getFriendlyError(error)\n            };\n        }\n    }\n\n    // ==========================================\n    // Utility Methods\n    // ==========================================\n\n    /**\n     * Search users (with OData injection protection)\n     */\n    async searchUsers(query) {\n        try {\n            // Validate and sanitize query\n            const validation = SecurityUtils.validateInput(query, {\n                maxLength: 200,\n                required: true,\n                minLength: 1\n            });\n\n            if (!validation.valid) {\n                return {\n                    success: false,\n                    error: validation.error,\n                    users: []\n                };\n            }\n\n            // Build safe OData filters\n            const displayNameFilter = SecurityUtils.buildODataFilter('displayName', 'startswith', validation.sanitized);\n            const upnFilter = SecurityUtils.buildODataFilter('userPrincipalName', 'startswith', validation.sanitized);\n\n            const response = await this.get(\n                `${this.baseUrl}/users?$filter=${displayNameFilter} or ${upnFilter}&$select=id,displayName,userPrincipalName&$top=10`\n            );\n            return {\n                success: true,\n                users: response.value || []\n            };\n        } catch (error) {\n            return {\n                success: false,\n                error: this.getFriendlyError(error),\n                users: []\n            };\n        }\n    }\n\n    /**\n     * Get PIM audit logs / directory audit logs\n     */\n    async getPIMAuditLogs(daysBack = 7) {\n        try {\n            const dateFilter = new Date();\n            dateFilter.setDate(dateFilter.getDate() - daysBack);\n\n            const response = await this.get(\n                `${this.baseUrl}/auditLogs/directoryAudits?$filter=activityDateTime ge ${dateFilter.toISOString()} and category eq 'RoleManagement'&$top=50&$orderby=activityDateTime desc`\n            );\n\n            return {\n                success: true,\n                logs: response.value || []\n            };\n        } catch (error) {\n            console.error('Failed to fetch audit logs:', error);\n            return {\n                success: false,\n                error: this.getFriendlyError(error),\n                logs: []\n            };\n        }\n    }\n\n    /**\n     * Get pending PIM approval requests\n     */\n    async getPendingApprovals() {\n        try {\n            const response = await this.get(\n                `${this.baseUrl}/roleManagement/directory/roleAssignmentScheduleRequests?$filter=status eq 'PendingApproval'&$expand=principal,roleDefinition`\n            );\n\n            return {\n                success: true,\n                requests: response.value || [],\n                count: response.value?.length || 0\n            };\n        } catch (error) {\n            console.error('Failed to fetch pending approvals:', error);\n            return {\n                success: false,\n                error: this.getFriendlyError(error),\n                requests: [],\n                count: 0\n            };\n        }\n    }\n\n    /**\n     * Approve or deny a PIM request\n     */\n    async reviewApprovalRequest(requestId, decision, justification) {\n        try {\n            // Step 1: Get the approval object for this request\n            // Use the roleAssignmentApprovals endpoint (beta API)\n            const approval = await this.get(\n                `${this.betaUrl}/roleManagement/directory/roleAssignmentApprovals/${requestId}`\n            );\n\n            if (!approval.steps || approval.steps.length === 0) {\n                return {\n                    success: false,\n                    error: 'No approval steps found'\n                };\n            }\n\n            // Step 2: Find the pending step for the current approver\n            const pendingStep = approval.steps.find(step =>\n                step.status === 'InProgress' || step.status === 'NotStarted'\n            );\n\n            if (!pendingStep) {\n                return {\n                    success: false,\n                    error: 'No pending approval step found. The request may have already been approved or denied.'\n                };\n            }\n\n            // Step 3: Update the approval step with our decision\n            const reviewResult = decision === 'approve' ? 'Approve' : 'Deny';\n\n            await this.patch(\n                `${this.betaUrl}/roleManagement/directory/roleAssignmentApprovals/${requestId}/steps/${pendingStep.id}`,\n                {\n                    reviewResult: reviewResult,\n                    justification: justification\n                }\n            );\n\n            return { success: true };\n        } catch (error) {\n            console.error('Failed to review approval:', error);\n            return {\n                success: false,\n                error: this.getFriendlyError(error)\n            };\n        }\n    }\n\n    /**\n     * Get active and eligible role assignments with expiration info\n     */\n    async getRoleAssignmentsWithExpiration() {\n        try {\n            // Get active assignments\n            const activeResponse = await this.get(\n                `${this.baseUrl}/roleManagement/directory/roleAssignmentScheduleInstances?$expand=principal,roleDefinition&$top=100`\n            );\n\n            // Get eligible assignments\n            const eligibleResponse = await this.get(\n                `${this.baseUrl}/roleManagement/directory/roleEligibilityScheduleInstances?$expand=principal,roleDefinition&$top=100`\n            );\n\n            const now = new Date();\n            const sevenDaysFromNow = new Date(now.getTime() + 7 * 24 * 60 * 60 * 1000);\n\n            const activeAssignments = (activeResponse.value || []).map(a => ({\n                ...a,\n                type: 'active',\n                isExpiring: a.endDateTime && new Date(a.endDateTime) <= sevenDaysFromNow\n            }));\n\n            const eligibleAssignments = (eligibleResponse.value || []).map(a => ({\n                ...a,\n                type: 'eligible',\n                isExpiring: a.endDateTime && new Date(a.endDateTime) <= sevenDaysFromNow\n            }));\n\n            const expiringAssignments = [...activeAssignments, ...eligibleAssignments]\n                .filter(a => a.isExpiring)\n                .sort((a, b) => new Date(a.endDateTime) - new Date(b.endDateTime));\n\n            return {\n                success: true,\n                activeCount: activeAssignments.length,\n                eligibleCount: eligibleAssignments.length,\n                expiringCount: expiringAssignments.length,\n                expiringAssignments: expiringAssignments\n            };\n        } catch (error) {\n            console.error('Failed to fetch role assignments:', error);\n            return {\n                success: false,\n                error: this.getFriendlyError(error),\n                activeCount: 0,\n                eligibleCount: 0,\n                expiringCount: 0,\n                expiringAssignments: []\n            };\n        }\n    }\n\n    /**\n     * Get role coverage report (which roles have PIM groups vs direct assignments)\n     */\n    async getRoleCoverageReport() {\n        try {\n            // Get all role-assignable groups\n            const groupsResult = await this.getPIMGroups();\n            const pimGroups = groupsResult.groups || [];\n\n            // Get all role eligibilities\n            const eligibilitiesResponse = await this.get(\n                `${this.baseUrl}/roleManagement/directory/roleEligibilityScheduleInstances?$expand=principal,roleDefinition&$top=200`\n            );\n\n            const eligibilities = eligibilitiesResponse.value || [];\n\n            // Categorize by principal type\n            const groupAssignments = eligibilities.filter(e => e.principal?.['@odata.type']?.includes('group'));\n            const userAssignments = eligibilities.filter(e => e.principal?.['@odata.type']?.includes('user'));\n\n            // Group by role\n            const roleMap = new Map();\n            eligibilities.forEach(e => {\n                const roleId = e.roleDefinition?.id;\n                if (!roleId) return;\n\n                if (!roleMap.has(roleId)) {\n                    roleMap.set(roleId, {\n                        roleId,\n                        roleName: e.roleDefinition?.displayName || 'Unknown',\n                        groupCount: 0,\n                        userCount: 0,\n                        isCovered: false\n                    });\n                }\n\n                const role = roleMap.get(roleId);\n                if (e.principal?.['@odata.type']?.includes('group')) {\n                    role.groupCount++;\n                    role.isCovered = true;\n                } else if (e.principal?.['@odata.type']?.includes('user')) {\n                    role.userCount++;\n                }\n            });\n\n            const rolesArray = Array.from(roleMap.values());\n            const coveredRoles = rolesArray.filter(r => r.isCovered);\n            const uncoveredRoles = rolesArray.filter(r => !r.isCovered);\n\n            return {\n                success: true,\n                totalRoles: rolesArray.length,\n                coveredRoles: coveredRoles.length,\n                uncoveredRoles: uncoveredRoles.length,\n                totalPIMGroups: pimGroups.length,\n                groupAssignmentsCount: groupAssignments.length,\n                directUserAssignmentsCount: userAssignments.length,\n                roles: rolesArray\n            };\n        } catch (error) {\n            console.error('Failed to generate coverage report:', error);\n            return {\n                success: false,\n                error: this.getFriendlyError(error)\n            };\n        }\n    }\n\n    /**\n     * Run PIM health check\n     */\n    async runHealthCheck() {\n        try {\n            const issues = [];\n            const warnings = [];\n\n            // Check 1: Get all role assignments\n            const assignmentsResult = await this.getRoleAssignmentsWithExpiration();\n\n            if (assignmentsResult.expiringCount > 0) {\n                warnings.push({\n                    severity: 'warning',\n                    category: 'Expiring Assignments',\n                    message: `${assignmentsResult.expiringCount} role assignments expiring within 7 days`,\n                    count: assignmentsResult.expiringCount\n                });\n            }\n\n            // Check 2: Get coverage report\n            const coverageResult = await this.getRoleCoverageReport();\n\n            if (coverageResult.success && coverageResult.directUserAssignmentsCount > 0) {\n                warnings.push({\n                    severity: 'info',\n                    category: 'Direct Assignments',\n                    message: `${coverageResult.directUserAssignmentsCount} direct user assignments found (consider using groups)`,\n                    count: coverageResult.directUserAssignmentsCount\n                });\n            }\n\n            // Check 3: Check for groups without members\n            const groupsResult = await this.getPIMGroups();\n            const emptyGroups = (groupsResult.groups || []).filter(g => g.memberCount === 0);\n\n            if (emptyGroups.length > 0) {\n                warnings.push({\n                    severity: 'info',\n                    category: 'Empty Groups',\n                    message: `${emptyGroups.length} PIM groups have no members`,\n                    count: emptyGroups.length,\n                    groups: emptyGroups.map(g => g.displayName)\n                });\n            }\n\n            // Check 4: Get pending approvals\n            const approvalsResult = await this.getPendingApprovals();\n\n            if (approvalsResult.count > 0) {\n                warnings.push({\n                    severity: 'warning',\n                    category: 'Pending Approvals',\n                    message: `${approvalsResult.count} approval requests awaiting review`,\n                    count: approvalsResult.count\n                });\n            }\n\n            const healthScore = Math.max(0, 100 - (issues.length * 20) - (warnings.length * 5));\n\n            return {\n                success: true,\n                healthScore,\n                status: healthScore >= 80 ? 'healthy' : healthScore >= 60 ? 'warning' : 'critical',\n                issues,\n                warnings,\n                checksRun: 4,\n                timestamp: new Date().toISOString()\n            };\n        } catch (error) {\n            console.error('Health check failed:', error);\n            return {\n                success: false,\n                error: this.getFriendlyError(error)\n            };\n        }\n    }\n\n    // ==========================================\n    // PIM Activation Workflow Methods\n    // ==========================================\n\n    /**\n     * Get current user's eligible role assignments\n     * @returns {Promise<Object>} Result with eligible roles\n     */\n    async getMyEligibleRoles() {\n        try {\n            const response = await this.get(\n                `${this.betaUrl}/roleManagement/directory/roleEligibilityScheduleInstances?` +\n                `$filter=principalId eq '${await this.getCurrentUserId()}'&` +\n                `$expand=roleDefinition`\n            );\n\n            const roles = (response.value || []).map(assignment => ({\n                id: assignment.id,\n                roleId: assignment.roleDefinitionId,\n                displayName: assignment.roleDefinition?.displayName || 'Unknown Role',\n                description: assignment.roleDefinition?.description || '',\n                privilegeLevel: this.determinePrivilegeLevel(assignment.roleDefinition?.displayName),\n                assignmentEnd: assignment.endDateTime,\n                requiresApproval: false, // Would need to query policy\n                requiresMfa: false, // Would need to query policy\n                requiresJustification: true,\n                requiresTicket: false,\n                maxDuration: 8,\n                defaultDuration: 4\n            }));\n\n            return {\n                success: true,\n                roles: roles\n            };\n        } catch (error) {\n            console.error('Failed to get eligible roles:', error);\n            return {\n                success: false,\n                error: this.getFriendlyError(error),\n                roles: []\n            };\n        }\n    }\n\n    /**\n     * Get current user's active role assignments\n     * @returns {Promise<Object>} Result with active roles\n     */\n    async getMyActiveRoles() {\n        try {\n            const response = await this.get(\n                `${this.betaUrl}/roleManagement/directory/roleAssignmentScheduleInstances?` +\n                `$filter=principalId eq '${await this.getCurrentUserId()}' and assignmentType eq 'Activated'&` +\n                `$expand=roleDefinition`\n            );\n\n            const roles = (response.value || []).map(assignment => ({\n                id: assignment.id,\n                roleId: assignment.roleDefinitionId,\n                displayName: assignment.roleDefinition?.displayName || 'Unknown Role',\n                description: assignment.roleDefinition?.description || '',\n                privilegeLevel: this.determinePrivilegeLevel(assignment.roleDefinition?.displayName),\n                startDateTime: assignment.startDateTime,\n                endDateTime: assignment.endDateTime,\n                justification: assignment.justification,\n                ticketNumber: assignment.ticketInfo?.ticketNumber,\n                canExtend: false // Would need to check policy\n            }));\n\n            return {\n                success: true,\n                roles: roles\n            };\n        } catch (error) {\n            console.error('Failed to get active roles:', error);\n            return {\n                success: false,\n                error: this.getFriendlyError(error),\n                roles: []\n            };\n        }\n    }\n\n    /**\n     * Get role assignment details\n     * @param {string} roleId - Role ID\n     * @returns {Promise<Object>} Result with role details\n     */\n    async getRoleAssignmentDetails(roleId) {\n        try {\n            // Try to get the actual policy from Microsoft Graph\n            // Note: This uses the roleManagementPolicies endpoint which may require additional permissions\n            try {\n                const response = await this.get(\n                    `${this.betaUrl}/policies/roleManagementPolicies?` +\n                    `$filter=scopeId eq '/' and scopeType eq 'DirectoryRole'&` +\n                    `$expand=rules`\n                );\n\n                // Find policy for this specific role\n                const policy = response.value.find(p =>\n                    p.rules?.some(r => r.target?.targetObjects?.some(obj => obj === roleId))\n                );\n\n                if (policy) {\n                    // Parse activation rules\n                    const activationRules = policy.rules || [];\n\n                    // Find enablement rules (MFA, approval, justification, ticket)\n                    const enablementRule = activationRules.find(r =>\n                        r['@odata.type'] === '#microsoft.graph.unifiedRoleManagementPolicyEnablementRule' &&\n                        r.target?.caller === 'EndUser' &&\n                        r.target?.operations?.includes('All')\n                    );\n\n                    // Find approval rules\n                    const approvalRule = activationRules.find(r =>\n                        r['@odata.type'] === '#microsoft.graph.unifiedRoleManagementPolicyApprovalRule' &&\n                        r.target?.caller === 'EndUser'\n                    );\n\n                    // Find expiration rules for duration\n                    const expirationRule = activationRules.find(r =>\n                        r['@odata.type'] === '#microsoft.graph.unifiedRoleManagementPolicyExpirationRule' &&\n                        r.target?.caller === 'EndUser' &&\n                        r.target?.operations?.includes('All')\n                    );\n\n                    const enabledRules = enablementRule?.enabledRules || [];\n\n                    return {\n                        success: true,\n                        requiresMFA: enabledRules.includes('MultiFactorAuthentication'),\n                        requiresApproval: approvalRule?.setting?.isApprovalRequired || false,\n                        requiresJustification: enabledRules.includes('Justification'),\n                        requiresTicket: enabledRules.includes('Ticketing'),\n                        maxDuration: this.parseIsoDuration(expirationRule?.maximumDuration) || 8,\n                        defaultDuration: 4,\n                        approvers: approvalRule?.setting?.approvalStages?.[0]?.primaryApprovers || []\n                    };\n                }\n            } catch (policyError) {\n                // If policy fetch fails (permissions issue), fall back to defaults\n                console.warn('Could not fetch policy, using defaults:', policyError.message);\n            }\n\n            // Return default policy requirements if we couldn't get the actual policy\n            return {\n                success: true,\n                requiresMFA: false,\n                requiresApproval: false,\n                requiresJustification: true,\n                requiresTicket: false,\n                maxDuration: 8,\n                defaultDuration: 4,\n                approvers: []\n            };\n        } catch (error) {\n            console.error('Failed to get role details:', error);\n            return {\n                success: false,\n                error: this.getFriendlyError(error)\n            };\n        }\n    }\n\n    /**\n     * Activate a role\n     * @param {Object} request - Activation request\n     * @returns {Promise<Object>} Result\n     */\n    async activateRole(request) {\n        try {\n            const userId = await this.getCurrentUserId();\n\n            // Create activation request\n            const activationRequest = {\n                principalId: userId,\n                roleDefinitionId: request.roleId,\n                directoryScopeId: '/',\n                action: 'selfActivate',\n                justification: request.justification || 'Role activation',\n                scheduleInfo: {\n                    startDateTime: new Date().toISOString(),\n                    expiration: {\n                        type: 'afterDuration',\n                        duration: `PT${request.duration}H`\n                    }\n                }\n            };\n\n            // Add ticket info if provided\n            if (request.ticketNumber) {\n                activationRequest.ticketInfo = {\n                    ticketNumber: request.ticketNumber,\n                    ticketSystem: 'Manual'\n                };\n            }\n\n            await this.post(\n                `${this.betaUrl}/roleManagement/directory/roleAssignmentScheduleRequests`,\n                activationRequest\n            );\n\n            return {\n                success: true,\n                requiresApproval: false // Would be determined by policy\n            };\n        } catch (error) {\n            console.error('Failed to activate role:', error);\n            return {\n                success: false,\n                error: this.getFriendlyError(error)\n            };\n        }\n    }\n\n    /**\n     * Deactivate a role\n     * @param {string} assignmentId - Assignment ID\n     * @returns {Promise<Object>} Result\n     */\n    async deactivateRole(assignmentId) {\n        try {\n            const userId = await this.getCurrentUserId();\n\n            // Get the assignment details first\n            const assignment = await this.get(\n                `${this.betaUrl}/roleManagement/directory/roleAssignmentScheduleInstances/${assignmentId}`\n            );\n\n            // Create deactivation request\n            const deactivationRequest = {\n                principalId: userId,\n                roleDefinitionId: assignment.roleDefinitionId,\n                directoryScopeId: '/',\n                action: 'selfDeactivate',\n                justification: 'Manual deactivation'\n            };\n\n            await this.post(\n                `${this.betaUrl}/roleManagement/directory/roleAssignmentScheduleRequests`,\n                deactivationRequest\n            );\n\n            return {\n                success: true\n            };\n        } catch (error) {\n            console.error('Failed to deactivate role:', error);\n            return {\n                success: false,\n                error: this.getFriendlyError(error)\n            };\n        }\n    }\n\n    /**\n     * Get current user ID\n     * @returns {Promise<string>} User ID\n     */\n    async getCurrentUserId() {\n        try {\n            const response = await this.get(`${this.baseUrl}/me?$select=id`);\n            return response.id;\n        } catch (error) {\n            console.error('Failed to get current user ID:', error);\n            throw error;\n        }\n    }\n\n    /**\n     * Determine privilege level based on role name\n     * @param {string} roleName - Role name\n     * @returns {string} Privilege level\n     */\n    determinePrivilegeLevel(roleName) {\n        const name = (roleName || '').toLowerCase();\n\n        if (name.includes('global admin') || name.includes('company admin')) {\n            return 'critical';\n        }\n        if (name.includes('privileged') || name.includes('security') || name.includes('compliance')) {\n            return 'high';\n        }\n        if (name.includes('admin') || name.includes('director')) {\n            return 'medium';\n        }\n\n        return 'low';\n    }\n\n    /**\n     * Convert error to user-friendly message\n     */\n    getFriendlyError(error) {\n        const message = error.message || error.toString();\n\n        if (error.status === 401) {\n            return 'Session expired. Please sign in again.';\n        }\n        if (error.status === 403) {\n            return 'You do not have permission to perform this action.';\n        }\n        if (error.status === 404) {\n            return 'Resource not found.';\n        }\n        if (error.code === 'Authorization_RequestDenied') {\n            return 'Access denied. Admin consent may be required.';\n        }\n\n        return message;\n    }\n}\n\n// Export singleton instance\nexport const graphService = new GraphService();\n","/**\n * Template Service\n * Manages policy templates for PIM configuration\n */\n\n// Predefined policy templates\nconst TEMPLATES = {\n    'standard': {\n        id: 'standard',\n        name: 'Standard Security',\n        description: 'Balanced security for typical enterprise use. Requires MFA and justification, with 8-hour activation window.',\n        icon: 'fa-shield-alt',\n        color: 'primary',\n        settings: {\n            activation: {\n                maximumDurationHours: 8,\n                requireMfa: true,\n                requireJustification: true,\n                requireTicketInfo: false,\n                requireApproval: false\n            },\n            eligibleAssignment: {\n                allowPermanent: true,\n                maximumDurationDays: 365\n            },\n            activeAssignment: {\n                allowPermanent: false,\n                maximumDurationDays: 30,\n                requireMfa: true,\n                requireJustification: true\n            }\n        }\n    },\n    'high-security': {\n        id: 'high-security',\n        name: 'High Security',\n        description: 'Maximum security with mandatory approval workflows. Short activation window with all security controls enabled.',\n        icon: 'fa-lock',\n        color: 'danger',\n        settings: {\n            activation: {\n                maximumDurationHours: 4,\n                requireMfa: true,\n                requireJustification: true,\n                requireTicketInfo: true,\n                requireApproval: true\n            },\n            eligibleAssignment: {\n                allowPermanent: false,\n                maximumDurationDays: 180\n            },\n            activeAssignment: {\n                allowPermanent: false,\n                maximumDurationDays: 7,\n                requireMfa: true,\n                requireJustification: true\n            }\n        }\n    },\n    'low-friction': {\n        id: 'low-friction',\n        name: 'Low Friction',\n        description: 'Streamlined access for trusted environments. Extended activation window with minimal approval barriers.',\n        icon: 'fa-bolt',\n        color: 'warning',\n        settings: {\n            activation: {\n                maximumDurationHours: 12,\n                requireMfa: true,\n                requireJustification: false,\n                requireTicketInfo: false,\n                requireApproval: false\n            },\n            eligibleAssignment: {\n                allowPermanent: true,\n                maximumDurationDays: 365\n            },\n            activeAssignment: {\n                allowPermanent: false,\n                maximumDurationDays: 90,\n                requireMfa: false,\n                requireJustification: false\n            }\n        }\n    },\n    'compliance': {\n        id: 'compliance',\n        name: 'Compliance Ready',\n        description: 'Settings aligned with SOX, HIPAA, and other regulatory requirements. Full audit trail with ticket tracking.',\n        icon: 'fa-clipboard-check',\n        color: 'success',\n        settings: {\n            activation: {\n                maximumDurationHours: 8,\n                requireMfa: true,\n                requireJustification: true,\n                requireTicketInfo: true,\n                requireApproval: true\n            },\n            eligibleAssignment: {\n                allowPermanent: false,\n                maximumDurationDays: 90\n            },\n            activeAssignment: {\n                allowPermanent: false,\n                maximumDurationDays: 14,\n                requireMfa: true,\n                requireJustification: true\n            }\n        }\n    }\n};\n\n// Custom templates stored in localStorage\nconst CUSTOM_TEMPLATES_KEY = 'pimbuddy-custom-templates';\n\nclass TemplateService {\n    constructor() {\n        this.customTemplates = this.loadCustomTemplates();\n    }\n\n    /**\n     * Get all available templates (built-in + custom)\n     */\n    getAllTemplates() {\n        return {\n            ...TEMPLATES,\n            ...this.customTemplates\n        };\n    }\n\n    /**\n     * Get built-in templates only\n     */\n    getBuiltInTemplates() {\n        return { ...TEMPLATES };\n    }\n\n    /**\n     * Get custom templates only\n     */\n    getCustomTemplates() {\n        return { ...this.customTemplates };\n    }\n\n    /**\n     * Get a specific template by ID\n     */\n    getTemplate(templateId) {\n        return this.getAllTemplates()[templateId] || null;\n    }\n\n    /**\n     * Get template settings for application\n     */\n    getTemplateSettings(templateId) {\n        const template = this.getTemplate(templateId);\n        if (!template) {\n            return null;\n        }\n        return template.settings;\n    }\n\n    /**\n     * Save a custom template\n     */\n    saveCustomTemplate(template) {\n        if (!template.id || !template.name || !template.settings) {\n            throw new Error('Template must have id, name, and settings');\n        }\n\n        // Mark as custom\n        template.isCustom = true;\n        template.createdAt = template.createdAt || new Date().toISOString();\n        template.updatedAt = new Date().toISOString();\n\n        this.customTemplates[template.id] = template;\n        this.persistCustomTemplates();\n\n        return template;\n    }\n\n    /**\n     * Delete a custom template\n     */\n    deleteCustomTemplate(templateId) {\n        if (!this.customTemplates[templateId]) {\n            return false;\n        }\n\n        delete this.customTemplates[templateId];\n        this.persistCustomTemplates();\n        return true;\n    }\n\n    /**\n     * Create a template from current group settings\n     */\n    createTemplateFromSettings(name, description, settings) {\n        const id = 'custom-' + Date.now();\n        return this.saveCustomTemplate({\n            id,\n            name,\n            description,\n            icon: 'fa-file-alt',\n            color: 'secondary',\n            isCustom: true,\n            settings\n        });\n    }\n\n    /**\n     * Compare two policy settings\n     */\n    compareSettings(current, template) {\n        const differences = [];\n\n        // Activation settings\n        if (current.activation.maximumDurationHours !== template.activation.maximumDurationHours) {\n            differences.push({\n                setting: 'Maximum Activation Duration',\n                current: `${current.activation.maximumDurationHours} hours`,\n                template: `${template.activation.maximumDurationHours} hours`\n            });\n        }\n        if (current.activation.requireMfa !== template.activation.requireMfa) {\n            differences.push({\n                setting: 'Require MFA',\n                current: current.activation.requireMfa ? 'Yes' : 'No',\n                template: template.activation.requireMfa ? 'Yes' : 'No'\n            });\n        }\n        if (current.activation.requireJustification !== template.activation.requireJustification) {\n            differences.push({\n                setting: 'Require Justification',\n                current: current.activation.requireJustification ? 'Yes' : 'No',\n                template: template.activation.requireJustification ? 'Yes' : 'No'\n            });\n        }\n        if (current.activation.requireApproval !== template.activation.requireApproval) {\n            differences.push({\n                setting: 'Require Approval',\n                current: current.activation.requireApproval ? 'Yes' : 'No',\n                template: template.activation.requireApproval ? 'Yes' : 'No'\n            });\n        }\n        if (current.activation.requireTicketInfo !== template.activation.requireTicketInfo) {\n            differences.push({\n                setting: 'Require Ticket Info',\n                current: current.activation.requireTicketInfo ? 'Yes' : 'No',\n                template: template.activation.requireTicketInfo ? 'Yes' : 'No'\n            });\n        }\n\n        return differences;\n    }\n\n    /**\n     * Load custom templates from localStorage\n     */\n    loadCustomTemplates() {\n        try {\n            const saved = localStorage.getItem(CUSTOM_TEMPLATES_KEY);\n            return saved ? JSON.parse(saved) : {};\n        } catch {\n            return {};\n        }\n    }\n\n    /**\n     * Persist custom templates to localStorage\n     */\n    persistCustomTemplates() {\n        localStorage.setItem(CUSTOM_TEMPLATES_KEY, JSON.stringify(this.customTemplates));\n    }\n}\n\nexport const templateService = new TemplateService();\n","/**\n * PIMMaid Service\n * Generates Mermaid diagrams from PIM configuration data\n */\n\nclass PIMMaidService {\n    constructor() {\n        this.diagramTypes = {\n            'user-group': {\n                name: 'Users  Groups',\n                description: 'Shows which users are eligible/active members of PIM groups',\n                icon: 'fa-users'\n            },\n            'group-role': {\n                name: 'Groups  Roles',\n                description: 'Shows which groups have assignments to Entra ID roles',\n                icon: 'fa-sitemap'\n            },\n            'full-hierarchy': {\n                name: 'Full Hierarchy',\n                description: 'Complete view: Users  Groups  Roles',\n                icon: 'fa-project-diagram'\n            },\n            'role-assignments': {\n                name: 'Role Assignments',\n                description: 'Shows all role assignments (direct and through groups)',\n                icon: 'fa-user-shield'\n            }\n        };\n    }\n\n    /**\n     * Generate a Mermaid diagram based on type and data\n     */\n    generateDiagram(type, data, options = {}) {\n        switch (type) {\n            case 'user-group':\n                return this.generateUserGroupDiagram(data, options);\n            case 'group-role':\n                return this.generateGroupRoleDiagram(data, options);\n            case 'full-hierarchy':\n                return this.generateFullHierarchyDiagram(data, options);\n            case 'role-assignments':\n                return this.generateRoleAssignmentsDiagram(data, options);\n            default:\n                return this.generateFullHierarchyDiagram(data, options);\n        }\n    }\n\n    /**\n     * Generate Users  Groups diagram\n     */\n    generateUserGroupDiagram(data, options = {}) {\n        const { groups = [], groupAssignments = {} } = data;\n        const { showEligible = true, showActive = true, direction = 'LR' } = options;\n\n        let mermaid = `flowchart ${direction}\\n`;\n        mermaid += `    %% PIMMaid - Users to Groups Diagram\\n`;\n        mermaid += `    %% Generated: ${new Date().toISOString()}\\n\\n`;\n\n        // Define subgraphs for users and groups\n        mermaid += `    subgraph Users[\" Users\"]\\n`;\n\n        const users = new Map();\n        const connections = [];\n\n        // Collect all users from assignments\n        for (const [groupId, assignments] of Object.entries(groupAssignments)) {\n            const group = groups.find(g => g.id === groupId);\n            if (!group) continue;\n\n            if (showEligible && assignments.eligible) {\n                for (const user of assignments.eligible) {\n                    if (!users.has(user.id)) {\n                        users.set(user.id, { ...user, type: 'user' });\n                    }\n                    connections.push({\n                        from: user.id,\n                        to: groupId,\n                        type: 'eligible',\n                        label: 'eligible'\n                    });\n                }\n            }\n\n            if (showActive && assignments.active) {\n                for (const user of assignments.active) {\n                    if (!users.has(user.id)) {\n                        users.set(user.id, { ...user, type: 'user' });\n                    }\n                    connections.push({\n                        from: user.id,\n                        to: groupId,\n                        type: 'active',\n                        label: 'active'\n                    });\n                }\n            }\n        }\n\n        // Add user nodes\n        for (const [userId, user] of users) {\n            const safeName = this.sanitizeId(user.displayName || userId);\n            mermaid += `        ${this.sanitizeId(userId)}[\"${safeName}\"]\\n`;\n        }\n        mermaid += `    end\\n\\n`;\n\n        // Add groups subgraph\n        mermaid += `    subgraph Groups[\" PIM Groups\"]\\n`;\n        for (const group of groups) {\n            if (groupAssignments[group.id]) {\n                const safeName = this.sanitizeId(group.displayName);\n                mermaid += `        ${this.sanitizeId(group.id)}[[\"${safeName}\"]]\\n`;\n            }\n        }\n        mermaid += `    end\\n\\n`;\n\n        // Add connections\n        mermaid += `    %% Connections\\n`;\n        for (const conn of connections) {\n            const style = conn.type === 'eligible' ? '-.->' : '-->';\n            const label = conn.type === 'eligible' ? '|eligible|' : '|active|';\n            mermaid += `    ${this.sanitizeId(conn.from)} ${style}${label} ${this.sanitizeId(conn.to)}\\n`;\n        }\n\n        // Add styling\n        mermaid += this.getDefaultStyles();\n\n        return mermaid;\n    }\n\n    /**\n     * Generate Groups  Roles diagram\n     */\n    generateGroupRoleDiagram(data, options = {}) {\n        const { groups = [], roles = [], roleAssignments = {} } = data;\n        const { direction = 'LR' } = options;\n\n        let mermaid = `flowchart ${direction}\\n`;\n        mermaid += `    %% PIMMaid - Groups to Roles Diagram\\n`;\n        mermaid += `    %% Generated: ${new Date().toISOString()}\\n\\n`;\n\n        // Groups subgraph\n        mermaid += `    subgraph Groups[\" PIM Groups\"]\\n`;\n        const usedGroups = new Set();\n\n        for (const [roleId, assignments] of Object.entries(roleAssignments)) {\n            for (const assignment of assignments) {\n                if (assignment.principalType === 'Group') {\n                    usedGroups.add(assignment.principalId);\n                }\n            }\n        }\n\n        for (const group of groups) {\n            if (usedGroups.has(group.id)) {\n                mermaid += `        ${this.sanitizeId(group.id)}[[\"${this.sanitizeId(group.displayName)}\"]]\\n`;\n            }\n        }\n        mermaid += `    end\\n\\n`;\n\n        // Roles subgraph with privilege levels\n        mermaid += `    subgraph Roles[\" Entra ID Roles\"]\\n`;\n        const usedRoles = new Set(Object.keys(roleAssignments));\n\n        for (const role of roles) {\n            if (usedRoles.has(role.id)) {\n                const icon = this.getPrivilegeIcon(role.privilegeLevel);\n                mermaid += `        ${this.sanitizeId(role.id)}[/\"${icon} ${this.sanitizeId(role.displayName)}\"\\\\]\\n`;\n            }\n        }\n        mermaid += `    end\\n\\n`;\n\n        // Connections\n        mermaid += `    %% Assignments\\n`;\n        for (const [roleId, assignments] of Object.entries(roleAssignments)) {\n            for (const assignment of assignments) {\n                if (assignment.principalType === 'Group') {\n                    const style = assignment.assignmentType === 'Eligible' ? '-.->' : '-->';\n                    const label = assignment.assignmentType === 'Eligible' ? '|eligible|' : '|active|';\n                    mermaid += `    ${this.sanitizeId(assignment.principalId)} ${style}${label} ${this.sanitizeId(roleId)}\\n`;\n                }\n            }\n        }\n\n        mermaid += this.getDefaultStyles();\n        return mermaid;\n    }\n\n    /**\n     * Generate full hierarchy diagram\n     */\n    generateFullHierarchyDiagram(data, options = {}) {\n        const { groups = [], roles = [], groupAssignments = {}, roleAssignments = {} } = data;\n        const { direction = 'LR', showEligible = true, showActive = true } = options;\n\n        let mermaid = `flowchart ${direction}\\n`;\n        mermaid += `    %% PIMMaid - Full PIM Hierarchy\\n`;\n        mermaid += `    %% Generated: ${new Date().toISOString()}\\n\\n`;\n\n        // Collect users\n        const users = new Map();\n        const userGroupLinks = [];\n        const groupRoleLinks = [];\n\n        // Process group assignments to get users\n        for (const [groupId, assignments] of Object.entries(groupAssignments)) {\n            if (showEligible && assignments.eligible) {\n                for (const user of assignments.eligible) {\n                    users.set(user.id, user);\n                    userGroupLinks.push({ userId: user.id, groupId, type: 'eligible' });\n                }\n            }\n            if (showActive && assignments.active) {\n                for (const user of assignments.active) {\n                    users.set(user.id, user);\n                    userGroupLinks.push({ userId: user.id, groupId, type: 'active' });\n                }\n            }\n        }\n\n        // Process role assignments to get group-role links\n        for (const [roleId, assignments] of Object.entries(roleAssignments)) {\n            for (const assignment of assignments) {\n                if (assignment.principalType === 'Group') {\n                    groupRoleLinks.push({\n                        groupId: assignment.principalId,\n                        roleId,\n                        type: assignment.assignmentType?.toLowerCase() || 'active'\n                    });\n                }\n            }\n        }\n\n        // Users subgraph\n        if (users.size > 0) {\n            mermaid += `    subgraph Users[\" Users\"]\\n`;\n            mermaid += `        direction TB\\n`;\n            for (const [userId, user] of users) {\n                mermaid += `        ${this.sanitizeId(userId)}[\"${this.sanitizeId(user.displayName || 'Unknown')}\"]\\n`;\n            }\n            mermaid += `    end\\n\\n`;\n        }\n\n        // Groups subgraph\n        const usedGroups = new Set([\n            ...userGroupLinks.map(l => l.groupId),\n            ...groupRoleLinks.map(l => l.groupId)\n        ]);\n\n        if (usedGroups.size > 0) {\n            mermaid += `    subgraph Groups[\" PIM Groups\"]\\n`;\n            mermaid += `        direction TB\\n`;\n            for (const group of groups) {\n                if (usedGroups.has(group.id)) {\n                    mermaid += `        ${this.sanitizeId(group.id)}[[\"${this.sanitizeId(group.displayName)}\"]]\\n`;\n                }\n            }\n            mermaid += `    end\\n\\n`;\n        }\n\n        // Roles subgraph\n        const usedRoles = new Set(groupRoleLinks.map(l => l.roleId));\n\n        if (usedRoles.size > 0) {\n            mermaid += `    subgraph Roles[\" Entra Roles\"]\\n`;\n            mermaid += `        direction TB\\n`;\n            for (const role of roles) {\n                if (usedRoles.has(role.id)) {\n                    const icon = this.getPrivilegeIcon(role.privilegeLevel);\n                    mermaid += `        ${this.sanitizeId(role.id)}[/\"${icon} ${this.sanitizeId(role.displayName)}\"\\\\]\\n`;\n                }\n            }\n            mermaid += `    end\\n\\n`;\n        }\n\n        // User  Group connections\n        mermaid += `    %% User to Group assignments\\n`;\n        for (const link of userGroupLinks) {\n            const style = link.type === 'eligible' ? '-.->' : '-->';\n            mermaid += `    ${this.sanitizeId(link.userId)} ${style} ${this.sanitizeId(link.groupId)}\\n`;\n        }\n\n        // Group  Role connections\n        mermaid += `\\n    %% Group to Role assignments\\n`;\n        for (const link of groupRoleLinks) {\n            const style = link.type === 'eligible' ? '-.->' : '-->';\n            mermaid += `    ${this.sanitizeId(link.groupId)} ${style} ${this.sanitizeId(link.roleId)}\\n`;\n        }\n\n        mermaid += this.getDefaultStyles();\n        return mermaid;\n    }\n\n    /**\n     * Generate role assignments diagram\n     */\n    generateRoleAssignmentsDiagram(data, options = {}) {\n        const { roles = [], roleAssignments = {} } = data;\n        const { direction = 'TB' } = options;\n\n        let mermaid = `flowchart ${direction}\\n`;\n        mermaid += `    %% PIMMaid - Role Assignments Overview\\n`;\n        mermaid += `    %% Generated: ${new Date().toISOString()}\\n\\n`;\n\n        // Group roles by privilege level\n        const criticalRoles = roles.filter(r => r.privilegeLevel === 'critical');\n        const highRoles = roles.filter(r => r.privilegeLevel === 'high');\n        const mediumRoles = roles.filter(r => r.privilegeLevel === 'medium');\n        const lowRoles = roles.filter(r => r.privilegeLevel === 'low');\n\n        const addRoleSubgraph = (roleList, label, emoji) => {\n            if (roleList.length === 0) return '';\n            let section = `    subgraph ${label.replace(/\\s/g, '')}[\"${emoji} ${label}\"]\\n`;\n            for (const role of roleList) {\n                if (roleAssignments[role.id]) {\n                    section += `        ${this.sanitizeId(role.id)}[/\"${this.sanitizeId(role.displayName)}\"\\\\]\\n`;\n                }\n            }\n            section += `    end\\n\\n`;\n            return section;\n        };\n\n        mermaid += addRoleSubgraph(criticalRoles, 'Critical Roles', '');\n        mermaid += addRoleSubgraph(highRoles, 'High Privilege', '');\n        mermaid += addRoleSubgraph(mediumRoles, 'Medium Privilege', '');\n        mermaid += addRoleSubgraph(lowRoles, 'Low Privilege', '');\n\n        // Principals (users/groups with assignments)\n        const principals = new Map();\n\n        for (const [roleId, assignments] of Object.entries(roleAssignments)) {\n            for (const assignment of assignments) {\n                if (!principals.has(assignment.principalId)) {\n                    principals.set(assignment.principalId, {\n                        id: assignment.principalId,\n                        name: assignment.principalDisplayName || 'Unknown',\n                        type: assignment.principalType\n                    });\n                }\n            }\n        }\n\n        if (principals.size > 0) {\n            mermaid += `    subgraph Principals[\" Assigned Principals\"]\\n`;\n            for (const [id, principal] of principals) {\n                const shape = principal.type === 'Group' ? `[[\"${this.sanitizeId(principal.name)}\"]]` : `[\"${this.sanitizeId(principal.name)}\"]`;\n                mermaid += `        ${this.sanitizeId(id)}${shape}\\n`;\n            }\n            mermaid += `    end\\n\\n`;\n        }\n\n        // Connections\n        mermaid += `    %% Assignments\\n`;\n        for (const [roleId, assignments] of Object.entries(roleAssignments)) {\n            for (const assignment of assignments) {\n                const style = assignment.assignmentType === 'Eligible' ? '-.->' : '-->';\n                mermaid += `    ${this.sanitizeId(assignment.principalId)} ${style} ${this.sanitizeId(roleId)}\\n`;\n            }\n        }\n\n        mermaid += this.getDefaultStyles();\n        return mermaid;\n    }\n\n    /**\n     * Get privilege level icon\n     */\n    getPrivilegeIcon(level) {\n        const icons = {\n            critical: '',\n            high: '',\n            medium: '',\n            low: ''\n        };\n        return icons[level] || '';\n    }\n\n    /**\n     * Sanitize ID for Mermaid compatibility\n     */\n    sanitizeId(str) {\n        if (!str) return 'unknown';\n        // Remove special characters and limit length\n        return str\n            .replace(/[^a-zA-Z0-9\\s-]/g, '')\n            .replace(/\\s+/g, '_')\n            .substring(0, 40);\n    }\n\n    /**\n     * Get default Mermaid styles\n     */\n    getDefaultStyles() {\n        return `\n    %% Styling\n    classDef userNode fill:#1e3a5f,stroke:#00d4aa,stroke-width:2px,color:#fff\n    classDef groupNode fill:#2d1b4e,stroke:#7c3aed,stroke-width:2px,color:#fff\n    classDef criticalRole fill:#4a1515,stroke:#ef4444,stroke-width:3px,color:#fff\n    classDef highRole fill:#4a3415,stroke:#f59e0b,stroke-width:2px,color:#fff\n    classDef mediumRole fill:#1e3a5f,stroke:#3b82f6,stroke-width:2px,color:#fff\n    classDef lowRole fill:#1a3a2a,stroke:#10b981,stroke-width:2px,color:#fff\n`;\n    }\n\n    /**\n     * Get all diagram types\n     */\n    getDiagramTypes() {\n        return this.diagramTypes;\n    }\n\n    /**\n     * Generate diagram statistics\n     */\n    getStats(data) {\n        const { groups = [], roles = [], groupAssignments = {}, roleAssignments = {} } = data;\n\n        let totalUsers = new Set();\n        let eligibleCount = 0;\n        let activeCount = 0;\n\n        for (const assignments of Object.values(groupAssignments)) {\n            if (assignments.eligible) {\n                assignments.eligible.forEach(u => totalUsers.add(u.id));\n                eligibleCount += assignments.eligible.length;\n            }\n            if (assignments.active) {\n                assignments.active.forEach(u => totalUsers.add(u.id));\n                activeCount += assignments.active.length;\n            }\n        }\n\n        const roleStats = {\n            critical: roles.filter(r => r.privilegeLevel === 'critical').length,\n            high: roles.filter(r => r.privilegeLevel === 'high').length,\n            medium: roles.filter(r => r.privilegeLevel === 'medium').length,\n            low: roles.filter(r => r.privilegeLevel === 'low').length\n        };\n\n        return {\n            totalUsers: totalUsers.size,\n            totalGroups: groups.length,\n            totalRoles: roles.length,\n            eligibleAssignments: eligibleCount,\n            activeAssignments: activeCount,\n            rolesByPrivilege: roleStats\n        };\n    }\n}\n\nexport const pimmaidService = new PIMMaidService();\n","/**\n * PIM Baseline Service\n * Implements industry best practices for PIM configuration\n * Based on Microsoft Zero Trust and Privileged Access Workstation (PAW) models\n */\n\nclass BaselineService {\n    constructor() {\n        // Tier-based access model (Microsoft privileged access strategy)\n        this.baselineConfigurations = {\n            'enterprise-standard': {\n                id: 'enterprise-standard',\n                name: 'Enterprise Standard',\n                description: 'Balanced security for typical enterprise environments. Implements tiered access with MFA and approval workflows for critical roles.',\n                icon: 'fa-building',\n                color: 'primary',\n                features: [\n                    'Tiered access model (T0/T1/T2)',\n                    'MFA required for all roles',\n                    'Approval required for Tier 0',\n                    'Justification tracking',\n                    '4-8 hour activation windows'\n                ],\n                tiers: [\n                    {\n                        tier: 0,\n                        name: 'Tier 0 - Critical Infrastructure',\n                        description: 'Highest privilege roles with maximum security controls',\n                        policy: {\n                            maximumDurationHours: 4,\n                            requireMfa: true,\n                            requireJustification: true,\n                            requireTicketInfo: true,\n                            requireApproval: true\n                        },\n                        groups: [\n                            {\n                                name: 'PIM-T0-Global-Administrators',\n                                description: 'Tier 0: Global Administrator role access',\n                                roles: ['62e90394-69f5-4237-9190-012177145e10'] // Global Administrator\n                            },\n                            {\n                                name: 'PIM-T0-Privileged-Role-Administrators',\n                                description: 'Tier 0: Privileged Role Administrator access',\n                                roles: ['e8611ab8-c189-46e8-94e1-60213ab1f814'] // Privileged Role Administrator\n                            },\n                            {\n                                name: 'PIM-T0-Security-Administrators',\n                                description: 'Tier 0: Security Administrator access',\n                                roles: ['194ae4cb-b126-40b2-bd5b-6091b380977d'] // Security Administrator\n                            }\n                        ]\n                    },\n                    {\n                        tier: 1,\n                        name: 'Tier 1 - High Privilege Operations',\n                        description: 'High privilege operational roles',\n                        policy: {\n                            maximumDurationHours: 8,\n                            requireMfa: true,\n                            requireJustification: true,\n                            requireTicketInfo: false,\n                            requireApproval: false\n                        },\n                        groups: [\n                            {\n                                name: 'PIM-T1-User-Administrators',\n                                description: 'Tier 1: User Administrator access',\n                                roles: ['fe930be7-5e62-47db-91af-98c3a49a38b1'] // User Administrator\n                            },\n                            {\n                                name: 'PIM-T1-Exchange-Administrators',\n                                description: 'Tier 1: Exchange Administrator access',\n                                roles: ['29232cdf-9323-42fd-ade2-1d097af3e4de'] // Exchange Administrator\n                            },\n                            {\n                                name: 'PIM-T1-SharePoint-Administrators',\n                                description: 'Tier 1: SharePoint Administrator access',\n                                roles: ['f28a1f50-f6e7-4571-818b-6a12f2af6b6c'] // SharePoint Administrator\n                            },\n                            {\n                                name: 'PIM-T1-Application-Administrators',\n                                description: 'Tier 1: Application Administrator access',\n                                roles: ['9b895d92-2cd3-44c7-9d02-a6ac2d5ea5c3'] // Application Administrator\n                            }\n                        ]\n                    },\n                    {\n                        tier: 2,\n                        name: 'Tier 2 - Standard Operations',\n                        description: 'Standard operational roles with moderate privilege',\n                        policy: {\n                            maximumDurationHours: 8,\n                            requireMfa: true,\n                            requireJustification: true,\n                            requireTicketInfo: false,\n                            requireApproval: false\n                        },\n                        groups: [\n                            {\n                                name: 'PIM-T2-Helpdesk-Administrators',\n                                description: 'Tier 2: Helpdesk Administrator access',\n                                roles: ['729827e3-9c14-49f7-bb1b-9608f156bbb8'] // Helpdesk Administrator\n                            },\n                            {\n                                name: 'PIM-T2-Groups-Administrators',\n                                description: 'Tier 2: Groups Administrator access',\n                                roles: ['fdd7a751-b60b-444a-984c-02652fe8fa1c'] // Groups Administrator\n                            },\n                            {\n                                name: 'PIM-T2-Teams-Administrators',\n                                description: 'Tier 2: Teams Administrator access',\n                                roles: ['69091246-20e8-4a56-aa4d-066075b2a7a8'] // Teams Administrator\n                            }\n                        ]\n                    }\n                ]\n            },\n            'high-security': {\n                id: 'high-security',\n                name: 'High Security (Zero Trust)',\n                description: 'Maximum security baseline for highly regulated industries. All roles require approval, short activation windows, and comprehensive audit trails.',\n                icon: 'fa-shield-alt',\n                color: 'danger',\n                features: [\n                    'Zero Trust security model',\n                    'Approval required for all tiers',\n                    'Ticket tracking mandatory',\n                    'Short activation (2-6 hours)',\n                    'Comprehensive audit trails',\n                    'MFA + Justification always required'\n                ],\n                tiers: [\n                    {\n                        tier: 0,\n                        name: 'Tier 0 - Critical Infrastructure',\n                        description: 'Maximum security for critical roles',\n                        policy: {\n                            maximumDurationHours: 2,\n                            requireMfa: true,\n                            requireJustification: true,\n                            requireTicketInfo: true,\n                            requireApproval: true\n                        },\n                        groups: [\n                            {\n                                name: 'PIM-ZT-T0-Global-Administrators',\n                                description: 'Zero Trust Tier 0: Global Administrator (2h max, full approval)',\n                                roles: ['62e90394-69f5-4237-9190-012177145e10']\n                            },\n                            {\n                                name: 'PIM-ZT-T0-Privileged-Role-Administrators',\n                                description: 'Zero Trust Tier 0: Privileged Role Administrator',\n                                roles: ['e8611ab8-c189-46e8-94e1-60213ab1f814']\n                            },\n                            {\n                                name: 'PIM-ZT-T0-Security-Administrators',\n                                description: 'Zero Trust Tier 0: Security Administrator',\n                                roles: ['194ae4cb-b126-40b2-bd5b-6091b380977d']\n                            }\n                        ]\n                    },\n                    {\n                        tier: 1,\n                        name: 'Tier 1 - High Privilege Operations',\n                        description: 'Strict controls for operational roles',\n                        policy: {\n                            maximumDurationHours: 4,\n                            requireMfa: true,\n                            requireJustification: true,\n                            requireTicketInfo: true,\n                            requireApproval: true\n                        },\n                        groups: [\n                            {\n                                name: 'PIM-ZT-T1-User-Administrators',\n                                description: 'Zero Trust Tier 1: User Administrator',\n                                roles: ['fe930be7-5e62-47db-91af-98c3a49a38b1']\n                            },\n                            {\n                                name: 'PIM-ZT-T1-Exchange-Administrators',\n                                description: 'Zero Trust Tier 1: Exchange Administrator',\n                                roles: ['29232cdf-9323-42fd-ade2-1d097af3e4de']\n                            },\n                            {\n                                name: 'PIM-ZT-T1-SharePoint-Administrators',\n                                description: 'Zero Trust Tier 1: SharePoint Administrator',\n                                roles: ['f28a1f50-f6e7-4571-818b-6a12f2af6b6c']\n                            }\n                        ]\n                    },\n                    {\n                        tier: 2,\n                        name: 'Tier 2 - Standard Operations',\n                        description: 'Enhanced security for standard roles',\n                        policy: {\n                            maximumDurationHours: 6,\n                            requireMfa: true,\n                            requireJustification: true,\n                            requireTicketInfo: true,\n                            requireApproval: false\n                        },\n                        groups: [\n                            {\n                                name: 'PIM-ZT-T2-Helpdesk-Administrators',\n                                description: 'Zero Trust Tier 2: Helpdesk Administrator',\n                                roles: ['729827e3-9c14-49f7-bb1b-9608f156bbb8']\n                            },\n                            {\n                                name: 'PIM-ZT-T2-Groups-Administrators',\n                                description: 'Zero Trust Tier 2: Groups Administrator',\n                                roles: ['fdd7a751-b60b-444a-984c-02652fe8fa1c']\n                            }\n                        ]\n                    }\n                ]\n            },\n            'quick-start': {\n                id: 'quick-start',\n                name: 'Quick Start (Development/POC)',\n                description: 'Simplified configuration for development environments and proof of concepts. Lower friction with basic security controls.',\n                icon: 'fa-rocket',\n                color: 'success',\n                features: [\n                    'Simplified 2-tier model',\n                    'MFA required only',\n                    'No approval workflows',\n                    'Extended activation (8-12 hours)',\n                    'Ideal for dev/test environments'\n                ],\n                tiers: [\n                    {\n                        tier: 0,\n                        name: 'Critical Roles',\n                        description: 'Essential admin roles with basic PIM',\n                        policy: {\n                            maximumDurationHours: 8,\n                            requireMfa: true,\n                            requireJustification: false,\n                            requireTicketInfo: false,\n                            requireApproval: false\n                        },\n                        groups: [\n                            {\n                                name: 'PIM-Global-Administrators',\n                                description: 'Global Administrator access',\n                                roles: ['62e90394-69f5-4237-9190-012177145e10']\n                            },\n                            {\n                                name: 'PIM-User-Administrators',\n                                description: 'User Administrator access',\n                                roles: ['fe930be7-5e62-47db-91af-98c3a49a38b1']\n                            }\n                        ]\n                    },\n                    {\n                        tier: 1,\n                        name: 'Operational Roles',\n                        description: 'Common operational roles',\n                        policy: {\n                            maximumDurationHours: 12,\n                            requireMfa: true,\n                            requireJustification: false,\n                            requireTicketInfo: false,\n                            requireApproval: false\n                        },\n                        groups: [\n                            {\n                                name: 'PIM-Helpdesk-Administrators',\n                                description: 'Helpdesk Administrator access',\n                                roles: ['729827e3-9c14-49f7-bb1b-9608f156bbb8']\n                            },\n                            {\n                                name: 'PIM-Teams-Administrators',\n                                description: 'Teams Administrator access',\n                                roles: ['69091246-20e8-4a56-aa4d-066075b2a7a8']\n                            }\n                        ]\n                    }\n                ]\n            }\n        };\n\n        // Best practices documentation\n        this.bestPractices = {\n            naming: {\n                title: 'Naming Convention',\n                description: 'Groups follow the pattern: PIM-[Tier]-[RoleName]. This makes it easy to identify privilege level at a glance.',\n                example: 'PIM-T0-Global-Administrators'\n            },\n            tiering: {\n                title: 'Tiered Access Model',\n                description: 'Tier 0 = Critical infrastructure, Tier 1 = High privilege operations, Tier 2 = Standard operations. Each tier has appropriate security controls.',\n                reference: 'Microsoft Privileged Access Strategy'\n            },\n            policies: {\n                title: 'Security Controls by Tier',\n                tier0: 'Shortest activation (2-4h), always MFA+Approval+Justification+Ticketing',\n                tier1: 'Medium activation (4-8h), MFA+Justification, optional approval',\n                tier2: 'Standard activation (6-12h), MFA+Justification'\n            },\n            assignments: {\n                title: 'Assignment Strategy',\n                description: 'Use eligible assignments (not active). Set time-bound eligibility (90-180 days) and require periodic revalidation.',\n                recommendation: 'Never use permanent active assignments for privileged roles'\n            }\n        };\n    }\n\n    /**\n     * Get all baseline configurations\n     */\n    getBaselineConfigurations() {\n        return this.baselineConfigurations;\n    }\n\n    /**\n     * Get a specific baseline configuration\n     */\n    getBaseline(baselineId) {\n        return this.baselineConfigurations[baselineId] || null;\n    }\n\n    /**\n     * Get best practices documentation\n     */\n    getBestPractices() {\n        return this.bestPractices;\n    }\n\n    /**\n     * Calculate deployment plan for a baseline\n     * @param {Object|string} config - Either a config object {baseline, tiers} or baseline ID string\n     * @param {Object} environment - Existing environment {existingGroups, existingRoles}\n     */\n    calculateDeploymentPlan(config, environment = {}) {\n        // Handle both config object and baseline ID string\n        let baseline, tiers;\n        if (typeof config === 'string') {\n            baseline = this.getBaseline(config);\n            tiers = baseline?.tiers || [];\n        } else {\n            baseline = this.getBaseline(config.baseline);\n            tiers = config.tiers || baseline?.tiers || [];\n        }\n\n        if (!baseline) return null;\n\n        const { existingGroups = [] } = environment;\n        const existingGroupNames = new Set(existingGroups.map(g => g.displayName));\n\n        // Build lists for deployment\n        const groupsToCreate = [];\n        const policiesToConfigure = [];\n        const roleAssignmentsToCreate = [];\n\n        for (const tier of tiers) {\n            for (const group of tier.groups) {\n                // Only add if group doesn't exist\n                if (!existingGroupNames.has(group.name)) {\n                    groupsToCreate.push({\n                        displayName: group.name,\n                        description: group.description,\n                        mailEnabled: false,\n                        mailNickname: group.name.replace(/[^a-zA-Z0-9]/g, '-').toLowerCase(),\n                        securityEnabled: true,\n                        isAssignableToRole: true,\n                        roles: group.roles,\n                        tier: tier.tier,\n                        policy: tier.policy\n                    });\n\n                    policiesToConfigure.push({\n                        groupName: group.name,\n                        policy: tier.policy\n                    });\n\n                    roleAssignmentsToCreate.push(...group.roles.map(roleId => ({\n                        groupName: group.name,\n                        roleId: roleId\n                    })));\n                }\n            }\n        }\n\n        // Calculate estimated time\n        const totalSeconds = (groupsToCreate.length * 15) + (policiesToConfigure.length * 10) + (roleAssignmentsToCreate.length * 5);\n        const estimatedMinutes = Math.ceil(totalSeconds / 60);\n\n        return {\n            baseline: baseline.name,\n            groupsToCreate,\n            policiesToConfigure,\n            roleAssignmentsToCreate,\n            estimatedTime: estimatedMinutes > 1 ? `${estimatedMinutes} minutes` : '< 1 minute',\n            steps: this.getDeploymentStepsList(groupsToCreate.length, policiesToConfigure.length)\n        };\n    }\n\n    /**\n     * Get deployment steps list for UI display\n     */\n    getDeploymentStepsList(groupCount, policyCount) {\n        return [\n            {\n                icon: 'fa-users',\n                title: 'Create PIM Groups',\n                description: `Create ${groupCount} role-assignable security groups with appropriate naming`\n            },\n            {\n                icon: 'fa-clock',\n                title: 'Wait for Provisioning',\n                description: 'Allow time for groups to be fully provisioned in Azure AD'\n            },\n            {\n                icon: 'fa-shield-alt',\n                title: 'Configure Policies',\n                description: `Apply ${policyCount} tier-specific policies (expiration, enablement, approval)`\n            },\n            {\n                icon: 'fa-check-circle',\n                title: 'Verify Deployment',\n                description: 'Confirm all groups and policies are correctly configured'\n            }\n        ];\n    }\n\n    /**\n     * Estimate deployment time in minutes\n     */\n    estimateDeploymentTime(groups, policies, assignments) {\n        // Rough estimates: 15s per group, 10s per policy, 5s per assignment\n        const totalSeconds = (groups * 15) + (policies * 10) + (assignments * 5);\n        return Math.ceil(totalSeconds / 60);\n    }\n\n    /**\n     * Get deployment steps for a baseline\n     */\n    getDeploymentSteps(baselineId, options = {}) {\n        const baseline = this.getBaseline(baselineId);\n        if (!baseline) return [];\n\n        const steps = [];\n        const { selectedTiers = null } = options;\n\n        let tiers = baseline.tiers;\n        if (selectedTiers) {\n            tiers = tiers.filter(t => selectedTiers.includes(t.tier));\n        }\n\n        // Step 1: Create groups\n        for (const tier of tiers) {\n            for (const group of tier.groups) {\n                steps.push({\n                    type: 'create-group',\n                    tier: tier.tier,\n                    tierName: tier.name,\n                    group: group,\n                    description: `Create group: ${group.name}`\n                });\n            }\n        }\n\n        // Step 2: Apply policies\n        for (const tier of tiers) {\n            for (const group of tier.groups) {\n                steps.push({\n                    type: 'apply-policy',\n                    tier: tier.tier,\n                    tierName: tier.name,\n                    group: group,\n                    policy: tier.policy,\n                    description: `Configure policy for: ${group.name}`\n                });\n            }\n        }\n\n        // Step 3: Create role assignments (if users are specified)\n        if (options.userAssignments) {\n            for (const tier of tiers) {\n                for (const group of tier.groups) {\n                    if (options.userAssignments[group.name]) {\n                        for (const userId of options.userAssignments[group.name]) {\n                            steps.push({\n                                type: 'assign-user',\n                                tier: tier.tier,\n                                tierName: tier.name,\n                                group: group,\n                                userId: userId,\n                                description: `Assign user to: ${group.name}`\n                            });\n                        }\n                    }\n                }\n            }\n        }\n\n        return steps;\n    }\n\n    /**\n     * Validate baseline configuration against existing environment\n     * @param {Object|string} config - Either a config object {baseline, tiers} or baseline ID string\n     * @param {Object} environment - Existing environment {existingGroups, existingRoles}\n     */\n    validateBaseline(config, environment = {}) {\n        // Handle both config object and baseline ID string\n        let baseline, tiers;\n        if (typeof config === 'string') {\n            baseline = this.getBaseline(config);\n            tiers = baseline?.tiers || [];\n        } else {\n            baseline = this.getBaseline(config.baseline);\n            tiers = config.tiers || baseline?.tiers || [];\n        }\n\n        if (!baseline) {\n            return {\n                valid: false,\n                errors: ['Baseline not found'],\n                warnings: []\n            };\n        }\n\n        const { existingGroups = [] } = environment;\n        const errors = [];\n        const warnings = [];\n        const existingGroupNames = new Set(existingGroups.map(g => g.displayName));\n\n        // Check for naming conflicts and count groups to create\n        let newGroupsCount = 0;\n        const existingGroupsList = [];\n        const newGroupsList = [];\n\n        for (const tier of tiers) {\n            for (const group of tier.groups) {\n                if (existingGroupNames.has(group.name)) {\n                    existingGroupsList.push(group.name);\n                    warnings.push(`Group \"${group.name}\" already exists and will be skipped`);\n                } else {\n                    newGroupsCount++;\n                    newGroupsList.push(group.name);\n                }\n            }\n        }\n\n        // Only error if NO groups will be created and user hasn't acknowledged\n        if (newGroupsCount === 0 && existingGroupsList.length > 0) {\n            warnings.push(`All ${existingGroupsList.length} groups already exist. Nothing to deploy.`);\n            warnings.push('Tip: Customize group names or delete existing groups first.');\n        }\n\n        return {\n            valid: newGroupsCount > 0, // Valid as long as at least one group can be created\n            errors,\n            warnings,\n            groupsToCreate: newGroupsCount,\n            existingGroups: existingGroupsList,\n            newGroups: newGroupsList\n        };\n    }\n\n    /**\n     * Get summary statistics for a baseline\n     */\n    getBaselineSummary(baselineId) {\n        const baseline = this.getBaseline(baselineId);\n        if (!baseline) return null;\n\n        const summary = {\n            name: baseline.name,\n            description: baseline.description,\n            tiers: baseline.tiers.length,\n            totalGroups: 0,\n            totalRoles: 0,\n            policies: {},\n            securityLevel: this.calculateSecurityLevel(baseline)\n        };\n\n        for (const tier of baseline.tiers) {\n            summary.totalGroups += tier.groups.length;\n            summary.totalRoles += tier.groups.reduce((sum, g) => sum + g.roles.length, 0);\n\n            // Count policy types\n            const policyKey = JSON.stringify(tier.policy);\n            if (!summary.policies[policyKey]) {\n                summary.policies[policyKey] = {\n                    ...tier.policy,\n                    count: 0\n                };\n            }\n            summary.policies[policyKey].count += tier.groups.length;\n        }\n\n        return summary;\n    }\n\n    /**\n     * Calculate overall security level score (0-100)\n     */\n    calculateSecurityLevel(baseline) {\n        let score = 0;\n        let totalGroups = 0;\n\n        for (const tier of baseline.tiers) {\n            for (const group of tier.groups) {\n                totalGroups++;\n                const policy = tier.policy;\n\n                // Scoring criteria\n                if (policy.requireMfa) score += 20;\n                if (policy.requireJustification) score += 15;\n                if (policy.requireApproval) score += 25;\n                if (policy.requireTicketInfo) score += 15;\n                if (policy.maximumDurationHours <= 4) score += 15;\n                else if (policy.maximumDurationHours <= 8) score += 10;\n                else score += 5;\n            }\n        }\n\n        return totalGroups > 0 ? Math.round(score / totalGroups) : 0;\n    }\n}\n\nexport const baselineService = new BaselineService();\n"],"names":["getMsalConfig","savedConfig","getSavedAppConfig","level","message","containsPii","saved","isAppConfigured","config","clearAppConfig","graphScopes","AuthService","msalConfig","PublicClientApplication","response","accounts","error","scopes","tokenRequest","InteractionRequiredAuthError","popupError","errorMessage","authService","_GraphService","endpoint","options","rateLimitType","rateLimiter","resetTime","defaultHeaders","errorBody","customHeaders","body","requests","chunks","allResponses","chunk","batchPayload","req","index","batchResponse","array","size","groups","batchRequests","group","batchResponses","groupsWithCounts","memberResponse","ownerResponse","memberCount","ownerCount","pageNumber","pageSize","skip","totalCount","displayName","description","mailNickname","groupId","userId","accessId","policiesResponse","policyId","rules","settings","policyResult","rawRules","updates","rule","ruleType","ruleId","enabledRules","target","duration","hours","enabled","approvalSetting","a","match","dayMatch","hourMatch","templateId","role","roleDefinitionId","emails","userIds","email","assignments","eligible","active","eligibleUsers","activeUsers","assignment","roleId","principalId","startDateTime","endDateTime","justification","durationMonths","startDate","endDate","query","validation","SecurityUtils","displayNameFilter","upnFilter","daysBack","dateFilter","requestId","decision","approval","pendingStep","step","reviewResult","activeResponse","eligibleResponse","now","sevenDaysFromNow","activeAssignments","eligibleAssignments","expiringAssignments","b","pimGroups","eligibilities","groupAssignments","e","userAssignments","roleMap","rolesArray","coveredRoles","r","uncoveredRoles","issues","warnings","assignmentsResult","coverageResult","emptyGroups","g","approvalsResult","healthScore","policy","p","obj","activationRules","enablementRule","approvalRule","expirationRule","policyError","request","activationRequest","assignmentId","deactivationRequest","roleName","name","__publicField","GraphService","graphService","TEMPLATES","CUSTOM_TEMPLATES_KEY","TemplateService","template","id","current","differences","templateService","PIMMaidService","type","data","showEligible","showActive","direction","mermaid","users","connections","user","safeName","conn","style","label","roles","roleAssignments","usedGroups","usedRoles","icon","userGroupLinks","groupRoleLinks","l","link","criticalRoles","highRoles","mediumRoles","lowRoles","addRoleSubgraph","roleList","emoji","section","principals","principal","shape","str","totalUsers","eligibleCount","activeCount","roleStats","pimmaidService","BaselineService","baselineId","environment","baseline","tiers","existingGroups","existingGroupNames","groupsToCreate","policiesToConfigure","roleAssignmentsToCreate","tier","totalSeconds","estimatedMinutes","groupCount","policyCount","policies","steps","selectedTiers","t","errors","newGroupsCount","existingGroupsList","newGroupsList","summary","sum","policyKey","score","totalGroups","baselineService"],"mappings":"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"}