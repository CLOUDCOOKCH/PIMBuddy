{"version":3,"file":"page-approvalspage-qJI2tH0l.js","sources":["../../src/pages/ApprovalsPage.js"],"sourcesContent":["/**\n * Approvals Page\n * Review and authorize PIM role activation requests\n */\n\nimport { BasePage } from '../core/PageRouter.js';\nimport { graphService } from '../services/graphService.js';\nimport { CACHE_KEYS } from '../core/CacheManager.js';\n\nexport class ApprovalsPage extends BasePage {\n    constructor(app) {\n        super(app);\n    }\n\n    /**\n     * Render Approvals page\n     * @param {HTMLElement} container - Page container\n     * @param {Object} params - Optional parameters\n     */\n    async render(container, params = {}) {\n        let approvals = [];\n        let count = 0;\n\n        if (this.isConnected()) {\n            this.showLoading('Loading pending approvals...');\n\n            // Try cache first\n            const cached = this.getCached(CACHE_KEYS.APPROVALS.key);\n\n            if (cached) {\n                approvals = cached.requests || [];\n                count = cached.count || 0;\n            } else {\n                const result = await graphService.getPendingApprovals();\n                if (result.success) {\n                    approvals = result.requests;\n                    count = result.count;\n                    this.setCached(CACHE_KEYS.APPROVALS.key, { requests: approvals, count });\n                } else {\n                    this.showToast(`Failed to load approvals: ${result.error}`, 'error');\n                }\n            }\n\n            this.hideLoading();\n        }\n\n        const formatDate = (dateStr) => {\n            if (!dateStr) return 'N/A';\n            const date = new Date(dateStr);\n            return date.toLocaleString();\n        };\n\n        container.innerHTML = `\n            <!-- Dramatic Page Header -->\n            <div style=\"position: relative; margin-bottom: var(--space-2xl); overflow: hidden;\">\n                <div style=\"position: absolute; top: -50%; left: -5%; width: 300px; height: 300px; background: radial-gradient(circle, var(--color-warning-dim), transparent); filter: blur(80px); animation: float 12s ease-in-out infinite; pointer-events: none;\"></div>\n                <div style=\"position: relative; z-index: 1;\">\n                    <div style=\"display: inline-flex; align-items: center; gap: var(--space-xs); padding: var(--space-xs) var(--space-md); background: rgba(255, 170, 0, 0.05); border: 1px solid var(--color-warning); border-radius: var(--radius-full); margin-bottom: var(--space-md); font-family: var(--font-mono); font-size: 0.65rem; text-transform: uppercase; letter-spacing: 0.15em;\">\n                        <i class=\"fas fa-bell\" style=\"color: var(--color-warning); font-size: 0.7rem;\"></i>\n                        <span style=\"color: var(--color-warning); font-weight: 600;\">APPROVAL QUEUE</span>\n                        <span style=\"color: var(--text-muted);\">|</span>\n                        <span style=\"color: var(--text-secondary);\">${count} PENDING</span>\n                    </div>\n                    <h1 style=\"font-family: var(--font-display); font-size: clamp(2rem, 4vw, 3rem); font-weight: 800; line-height: 1.1; margin-bottom: var(--space-sm); letter-spacing: -0.03em;\">\n                        <span style=\"background: linear-gradient(135deg, var(--color-warning), #ffdd00); -webkit-background-clip: text; -webkit-text-fill-color: transparent; filter: drop-shadow(0 0 30px rgba(255, 170, 0, 0.3));\">\n                            PENDING\n                        </span>\n                        <span style=\"color: var(--text-primary);\"> APPROVALS</span>\n                    </h1>\n                    <p style=\"font-size: 0.95rem; color: var(--text-secondary); font-family: var(--font-mono);\">\n                        Review and authorize privileged role activation requests\n                    </p>\n                </div>\n            </div>\n\n            <div class=\"card\" style=\"position: relative; overflow: hidden; background: linear-gradient(135deg, var(--bg-elevated), var(--bg-surface)); border: 1px solid ${count > 0 ? 'var(--color-warning)' : 'var(--border-subtle)'};\">\n                <div style=\"position: absolute; top: 0; left: 0; width: 400px; height: 400px; background: radial-gradient(circle, ${count > 0 ? 'rgba(255, 170, 0, 0.05)' : 'var(--accent-primary-dim)'}, transparent); filter: blur(100px); pointer-events: none;\"></div>\n\n                <div style=\"position: relative; z-index: 1;\">\n                    <div style=\"display: flex; align-items: center; justify-content: space-between; padding: var(--space-lg); border-bottom: 1px solid var(--border-subtle);\">\n                        <div style=\"display: flex; align-items: center; gap: var(--space-md);\">\n                            <div style=\"width: 48px; height: 48px; background: ${count > 0 ? 'var(--color-warning-dim)' : 'var(--accent-primary-dim)'}; border-radius: var(--radius-md); display: flex; align-items: center; justify-content: center;\">\n                                <i class=\"fas fa-clock\" style=\"color: ${count > 0 ? 'var(--color-warning)' : 'var(--accent-primary)'}; font-size: 1.3rem;\"></i>\n                            </div>\n                            <div>\n                                <h2 style=\"font-family: var(--font-display); font-size: 1.4rem; font-weight: 700; margin: 0; text-transform: uppercase; letter-spacing: 0.05em;\">\n                                    Approval Queue\n                                </h2>\n                                <div style=\"font-family: var(--font-mono); font-size: 0.75rem; color: var(--text-secondary); margin-top: 2px;\">\n                                    ${count} requests awaiting review\n                                </div>\n                            </div>\n                        </div>\n                        <button class=\"btn btn-secondary btn-sm\" onclick=\"app.pages.approvals.refreshPage()\" ${!this.isConnected() ? 'disabled' : ''} style=\"font-family: var(--font-mono);\" aria-label=\"Refresh approvals\">\n                            <i class=\"fas fa-sync\"></i> REFRESH\n                        </button>\n                    </div>\n\n                    <div style=\"padding: var(--space-md);\">\n                        ${approvals.length > 0 ? approvals.map((approval, idx) => `\n                            <div style=\"background: rgba(255, 170, 0, 0.05); border: 1px solid var(--color-warning); border-radius: var(--radius-lg); padding: var(--space-lg); margin-bottom: var(--space-md); position: relative; overflow: hidden;\" role=\"article\" aria-label=\"Approval request from ${this.escapeHtml(approval.principal?.displayName || 'Unknown User')}\">\n                                <div style=\"position: absolute; top: 0; right: 0; width: 150px; height: 150px; background: radial-gradient(circle, rgba(255, 170, 0, 0.1), transparent); filter: blur(40px); pointer-events: none;\"></div>\n                                <div style=\"position: relative; z-index: 1;\">\n                                    <div style=\"display: flex; justify-content: space-between; align-items: start; gap: var(--space-lg); margin-bottom: var(--space-lg);\">\n                                        <div style=\"flex: 1;\">\n                                            <!-- User Info -->\n                                            <div style=\"display: flex; align-items: center; gap: var(--space-sm); margin-bottom: var(--space-md);\">\n                                                <div style=\"width: 36px; height: 36px; background: var(--accent-primary-dim); border-radius: 50%; display: flex; align-items: center; justify-content: center;\">\n                                                    <i class=\"fas fa-user\" style=\"color: var(--accent-primary); font-size: 1rem;\"></i>\n                                                </div>\n                                                <div>\n                                                    <div style=\"font-weight: 700; font-size: 1.1rem; color: var(--text-primary);\">\n                                                        ${this.escapeHtml(approval.principal?.displayName || 'Unknown User')}\n                                                    </div>\n                                                    <div style=\"font-size: 0.75rem; color: var(--text-muted); font-family: var(--font-mono);\">\n                                                        ${this.escapeHtml(approval.principal?.userPrincipalName || 'N/A')}\n                                                    </div>\n                                                </div>\n                                            </div>\n\n                                            <!-- Role -->\n                                            <div style=\"display: flex; align-items: center; gap: var(--space-sm); margin-bottom: var(--space-md); padding: var(--space-sm) var(--space-md); background: rgba(0, 255, 159, 0.05); border-left: 3px solid var(--accent-primary); border-radius: var(--radius-sm);\">\n                                                <i class=\"fas fa-shield-check\" style=\"color: var(--accent-primary);\"></i>\n                                                <div>\n                                                    <div style=\"font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.1em; color: var(--text-muted); font-family: var(--font-mono); margin-bottom: 2px;\">\n                                                        REQUESTING ROLE\n                                                    </div>\n                                                    <div style=\"font-weight: 600; color: var(--text-primary);\">\n                                                        ${this.escapeHtml(approval.roleDefinition?.displayName || 'Unknown Role')}\n                                                    </div>\n                                                </div>\n                                            </div>\n\n                                            <!-- Justification -->\n                                            <div style=\"background: rgba(0, 0, 0, 0.2); padding: var(--space-md); border-radius: var(--radius-sm); margin-bottom: var(--space-md);\">\n                                                <div style=\"font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.1em; color: var(--text-muted); font-family: var(--font-mono); margin-bottom: var(--space-xs);\">\n                                                    <i class=\"fas fa-comment-dots\"></i> JUSTIFICATION\n                                                </div>\n                                                <div style=\"color: var(--text-secondary); line-height: 1.5; font-size: 0.9rem;\">\n                                                    ${this.escapeHtml(approval.justification || 'No justification provided')}\n                                                </div>\n                                            </div>\n\n                                            <!-- Timestamp -->\n                                            <div style=\"display: flex; align-items: center; gap: var(--space-xs); font-size: 0.8rem; color: var(--text-muted); font-family: var(--font-mono);\">\n                                                <i class=\"fas fa-clock\"></i>\n                                                <span>Requested: ${formatDate(approval.createdDateTime)}</span>\n                                            </div>\n                                        </div>\n\n                                        <!-- Action Buttons -->\n                                        <div style=\"display: flex; flex-direction: column; gap: var(--space-sm); min-width: 140px;\">\n                                            <button class=\"btn btn-success\" onclick=\"app.pages.approvals.reviewApproval('${approval.id}', 'approve')\" style=\"width: 100%; font-family: var(--font-mono); font-size: 0.85rem; padding: var(--space-md);\" aria-label=\"Approve request from ${this.escapeHtml(approval.principal?.displayName || 'Unknown User')}\">\n                                                <i class=\"fas fa-check-circle\"></i> APPROVE\n                                            </button>\n                                            <button class=\"btn btn-danger\" onclick=\"app.pages.approvals.reviewApproval('${approval.id}', 'deny')\" style=\"width: 100%; font-family: var(--font-mono); font-size: 0.85rem; padding: var(--space-md);\" aria-label=\"Deny request from ${this.escapeHtml(approval.principal?.displayName || 'Unknown User')}\">\n                                                <i class=\"fas fa-times-circle\"></i> DENY\n                                            </button>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                        `).join('') : `\n                            <div style=\"text-align: center; padding: var(--space-2xl) var(--space-lg); color: var(--text-secondary);\">\n                                <div style=\"width: 120px; height: 120px; margin: 0 auto var(--space-xl); background: var(--accent-primary-dim); border-radius: 50%; display: flex; align-items: center; justify-content: center;\">\n                                    <i class=\"fas fa-check-double\" style=\"font-size: 3.5rem; color: var(--accent-primary); opacity: 0.5;\"></i>\n                                </div>\n                                <div style=\"font-family: var(--font-display); font-size: 1.5rem; font-weight: 700; margin-bottom: var(--space-sm); color: var(--text-primary);\">\n                                    All Caught Up\n                                </div>\n                                <div style=\"font-family: var(--font-mono); font-size: 0.9rem; color: var(--text-muted);\">\n                                    ${this.isConnected() ? 'No pending approval requests in the queue' : 'Connect to Microsoft Entra ID to view pending approvals'}\n                                </div>\n                            </div>\n                        `}\n                    </div>\n                </div>\n            </div>\n        `;\n    }\n\n    /**\n     * Review approval request\n     * @param {string} requestId - Request ID\n     * @param {string} decision - Decision (approve/deny)\n     */\n    async reviewApproval(requestId, decision) {\n        const justification = prompt(`${decision === 'approve' ? 'Approve' : 'Deny'} this request?\\n\\nEnter justification:`);\n        if (!justification) return;\n\n        this.showLoading(`${decision === 'approve' ? 'Approving' : 'Denying'} request...`);\n        const result = await graphService.reviewApprovalRequest(requestId, decision, justification);\n        this.hideLoading();\n\n        if (result.success) {\n            this.showToast(`Request ${decision === 'approve' ? 'approved' : 'denied'} successfully`, 'success');\n            this.refreshPage();\n        } else {\n            this.showToast(result.error, 'error');\n        }\n    }\n\n    /**\n     * Refresh page data\n     */\n    async refreshPage() {\n        this.app.cacheManager.invalidate(CACHE_KEYS.APPROVALS.key);\n        await this.app.router.refreshCurrentPage();\n    }\n}\n"],"names":["ApprovalsPage","BasePage","app","container","params","approvals","count","cached","CACHE_KEYS","result","graphService","formatDate","dateStr","approval","idx","requestId","decision","justification"],"mappings":"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"}