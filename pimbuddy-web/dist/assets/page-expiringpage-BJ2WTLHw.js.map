{"version":3,"file":"page-expiringpage-BJ2WTLHw.js","sources":["../../src/pages/ExpiringPage.js"],"sourcesContent":["/**\n * Expiring Assignments Page\n * Monitor and track role assignments expiring within 7 days\n */\n\nimport { BasePage } from '../core/PageRouter.js';\nimport { graphService } from '../services/graphService.js';\nimport { CACHE_KEYS } from '../core/CacheManager.js';\n\nexport class ExpiringPage extends BasePage {\n    constructor(app) {\n        super(app);\n    }\n\n    /**\n     * Render Expiring Assignments page\n     * @param {HTMLElement} container - Page container\n     * @param {Object} params - Optional parameters\n     */\n    async render(container, params = {}) {\n        let assignments = [];\n        let expiringCount = 0;\n\n        if (this.isConnected()) {\n            this.showLoading('Loading expiring assignments...');\n\n            // Try cache first\n            const cached = this.getCached(CACHE_KEYS.EXPIRING_ASSIGNMENTS.key);\n\n            if (cached) {\n                assignments = cached.expiringAssignments || [];\n                expiringCount = cached.expiringCount || 0;\n            } else {\n                const result = await graphService.getRoleAssignmentsWithExpiration();\n                if (result.success) {\n                    assignments = result.expiringAssignments;\n                    expiringCount = result.expiringCount;\n                    this.setCached(CACHE_KEYS.EXPIRING_ASSIGNMENTS.key, {\n                        expiringAssignments: assignments,\n                        expiringCount\n                    });\n                } else {\n                    this.showToast(`Failed to load expiring assignments: ${result.error}`, 'error');\n                }\n            }\n\n            this.hideLoading();\n        }\n\n        const formatDate = (dateStr) => {\n            if (!dateStr) return 'N/A';\n            const date = new Date(dateStr);\n            return date.toLocaleString();\n        };\n\n        const formatRelativeTime = (dateStr) => {\n            if (!dateStr) return 'N/A';\n            const date = new Date(dateStr);\n            const now = new Date();\n            const diff = date - now;\n            const days = Math.floor(diff / (1000 * 60 * 60 * 24));\n            const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));\n\n            if (days > 0) return `${days}d ${hours}h`;\n            if (hours > 0) return `${hours}h`;\n            if (diff > 0) return '< 1h';\n            return 'Expired';\n        };\n\n        container.innerHTML = `\n            <!-- Dramatic Page Header -->\n            <div style=\"position: relative; margin-bottom: var(--space-2xl); overflow: hidden;\">\n                <div style=\"position: absolute; top: -50%; right: -5%; width: 300px; height: 300px; background: radial-gradient(circle, rgba(255, 100, 0, 0.1), transparent); filter: blur(80px); animation: float 10s ease-in-out infinite; pointer-events: none;\"></div>\n                <div style=\"position: relative; z-index: 1;\">\n                    <div style=\"display: inline-flex; align-items: center; gap: var(--space-xs); padding: var(--space-xs) var(--space-md); background: rgba(255, 100, 0, 0.05); border: 1px solid #ff6400; border-radius: var(--radius-full); margin-bottom: var(--space-md); font-family: var(--font-mono); font-size: 0.65rem; text-transform: uppercase; letter-spacing: 0.15em;\">\n                        <i class=\"fas fa-exclamation-triangle\" style=\"color: #ff6400; font-size: 0.7rem;\"></i>\n                        <span style=\"color: #ff6400; font-weight: 600;\">TIME SENSITIVE</span>\n                        <span style=\"color: var(--text-muted);\">|</span>\n                        <span style=\"color: var(--text-secondary);\">${expiringCount} EXPIRING</span>\n                    </div>\n                    <h1 style=\"font-family: var(--font-display); font-size: clamp(2rem, 4vw, 3rem); font-weight: 800; line-height: 1.1; margin-bottom: var(--space-sm); letter-spacing: -0.03em;\">\n                        <span style=\"background: linear-gradient(135deg, #ff6400, #ff0080); -webkit-background-clip: text; -webkit-text-fill-color: transparent; filter: drop-shadow(0 0 30px rgba(255, 100, 0, 0.3));\">\n                            EXPIRING\n                        </span>\n                        <span style=\"color: var(--text-primary);\"> ASSIGNMENTS</span>\n                    </h1>\n                    <p style=\"font-size: 0.95rem; color: var(--text-secondary); font-family: var(--font-mono);\">\n                        Role assignments expiring within 7 days - immediate attention required\n                    </p>\n                </div>\n            </div>\n\n            <div class=\"card\" style=\"position: relative; overflow: hidden; background: linear-gradient(135deg, var(--bg-elevated), var(--bg-surface)); border: 1px solid ${expiringCount > 0 ? '#ff6400' : 'var(--border-subtle)'};\">\n                <div style=\"position: absolute; top: 0; right: 0; width: 400px; height: 400px; background: radial-gradient(circle, ${expiringCount > 0 ? 'rgba(255, 100, 0, 0.05)' : 'var(--accent-primary-dim)'}, transparent); filter: blur(100px); pointer-events: none;\"></div>\n\n                <div style=\"position: relative; z-index: 1;\">\n                    <div style=\"display: flex; align-items: center; justify-content: space-between; padding: var(--space-lg); border-bottom: 1px solid var(--border-subtle);\">\n                        <div style=\"display: flex; align-items: center; gap: var(--space-md);\">\n                            <div style=\"width: 48px; height: 48px; background: ${expiringCount > 0 ? 'rgba(255, 100, 0, 0.1)' : 'var(--accent-primary-dim)'}; border-radius: var(--radius-md); display: flex; align-items: center; justify-content: center;\">\n                                <i class=\"fas fa-hourglass-end\" style=\"color: ${expiringCount > 0 ? '#ff6400' : 'var(--accent-primary)'}; font-size: 1.3rem;\"></i>\n                            </div>\n                            <div>\n                                <h2 style=\"font-family: var(--font-display); font-size: 1.4rem; font-weight: 700; margin: 0; text-transform: uppercase; letter-spacing: 0.05em;\">\n                                    Expiring Assignments\n                                </h2>\n                                <div style=\"font-family: var(--font-mono); font-size: 0.75rem; color: var(--text-secondary); margin-top: 2px;\">\n                                    ${expiringCount} assignments require renewal\n                                </div>\n                            </div>\n                        </div>\n                        <button class=\"btn btn-secondary btn-sm\" onclick=\"app.pages.expiring.refreshPage()\" ${!this.isConnected() ? 'disabled' : ''} style=\"font-family: var(--font-mono);\" aria-label=\"Refresh expiring assignments\">\n                            <i class=\"fas fa-sync\"></i> REFRESH\n                        </button>\n                    </div>\n\n                    <div style=\"overflow-x: auto;\">\n                        ${assignments.length > 0 ? `\n                            <table class=\"table\" style=\"margin: 0;\">\n                                <thead>\n                                    <tr style=\"background: rgba(0, 0, 0, 0.3);\">\n                                        <th style=\"font-family: var(--font-mono); font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.1em;\">Principal</th>\n                                        <th style=\"font-family: var(--font-mono); font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.1em;\">Role</th>\n                                        <th style=\"font-family: var(--font-mono); font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.1em;\">Type</th>\n                                        <th style=\"font-family: var(--font-mono); font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.1em;\">Expiration Date</th>\n                                        <th style=\"font-family: var(--font-mono); font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.1em;\">Time Left</th>\n                                    </tr>\n                                </thead>\n                                <tbody>\n                                    ${assignments.map((assignment, idx) => {\n                                        const timeLeft = formatRelativeTime(assignment.endDateTime);\n                                        const isUrgent = timeLeft.includes('h') || timeLeft === 'Expired';\n                                        return `\n                                        <tr style=\"border-bottom: 1px solid var(--border-subtle); background: ${idx % 2 === 0 ? 'rgba(255, 100, 0, 0.02)' : 'transparent'};\">\n                                            <td>\n                                                <div style=\"font-weight: 600; font-size: 0.9rem; margin-bottom: 2px; color: var(--text-primary);\">${this.escapeHtml(assignment.principal?.displayName || 'Unknown')}</div>\n                                                <div style=\"font-size: 0.75rem; color: var(--text-muted); font-family: var(--font-mono);\">\n                                                    ${this.escapeHtml(assignment.principal?.userPrincipalName || assignment.principal?.mail || 'N/A')}\n                                                </div>\n                                            </td>\n                                            <td style=\"font-size: 0.9rem; font-weight: 500; color: var(--text-primary);\">\n                                                ${this.escapeHtml(assignment.roleDefinition?.displayName || 'Unknown Role')}\n                                            </td>\n                                            <td>\n                                                <span class=\"badge\" style=\"background: ${assignment.type === 'active' ? 'var(--color-success-dim)' : 'var(--bg-elevated)'}; color: ${assignment.type === 'active' ? 'var(--color-success)' : 'var(--text-secondary)'}; font-family: var(--font-mono); font-size: 0.7rem; text-transform: uppercase;\">\n                                                    ${assignment.type}\n                                                </span>\n                                            </td>\n                                            <td style=\"white-space: nowrap; font-family: var(--font-mono); font-size: 0.8rem; color: var(--text-secondary);\">\n                                                ${formatDate(assignment.endDateTime)}\n                                            </td>\n                                            <td>\n                                                <span class=\"badge\" style=\"background: ${isUrgent ? 'rgba(255, 0, 85, 0.1)' : 'rgba(255, 100, 0, 0.1)'}; color: ${isUrgent ? 'var(--color-error)' : '#ff6400'}; font-family: var(--font-mono); font-size: 0.75rem; font-weight: 700; text-transform: uppercase; padding: var(--space-xs) var(--space-sm); ${isUrgent ? 'animation: pulse 2s ease-in-out infinite;' : ''}\">\n                                                    ${isUrgent ? 'âš  ' : ''}${timeLeft}\n                                                </span>\n                                            </td>\n                                        </tr>\n                                    `}).join('')}\n                                </tbody>\n                            </table>\n                        ` : `\n                            <div style=\"text-align: center; padding: var(--space-2xl) var(--space-lg); color: var(--text-secondary);\">\n                                <div style=\"width: 120px; height: 120px; margin: 0 auto var(--space-xl); background: var(--accent-primary-dim); border-radius: 50%; display: flex; align-items: center; justify-content: center;\">\n                                    <i class=\"fas fa-check-circle\" style=\"font-size: 3.5rem; color: var(--accent-primary); opacity: 0.5;\"></i>\n                                </div>\n                                <div style=\"font-family: var(--font-display); font-size: 1.5rem; font-weight: 700; margin-bottom: var(--space-sm); color: var(--text-primary);\">\n                                    All Clear\n                                </div>\n                                <div style=\"font-family: var(--font-mono); font-size: 0.9rem; color: var(--text-muted);\">\n                                    ${this.isConnected() ? 'No role assignments expiring within the next 7 days' : 'Connect to Microsoft Entra ID to monitor expiring assignments'}\n                                </div>\n                            </div>\n                        `}\n                    </div>\n                </div>\n            </div>\n        `;\n    }\n\n    /**\n     * Refresh page data\n     */\n    async refreshPage() {\n        this.app.cacheManager.invalidate(CACHE_KEYS.EXPIRING_ASSIGNMENTS.key);\n        await this.app.router.refreshCurrentPage();\n    }\n}\n"],"names":["ExpiringPage","BasePage","app","container","params","assignments","expiringCount","cached","CACHE_KEYS","result","graphService","formatDate","dateStr","formatRelativeTime","diff","days","hours","assignment","idx","timeLeft","isUrgent"],"mappings":"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"}