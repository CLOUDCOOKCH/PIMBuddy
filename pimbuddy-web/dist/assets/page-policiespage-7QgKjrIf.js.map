{"version":3,"file":"page-policiespage-7QgKjrIf.js","sources":["../../src/pages/PoliciesPage.js"],"sourcesContent":["/**\n * Policies Page\n * Configure PIM activation settings for Entra ID roles\n * Note: This is a simplified view - full policy editor is in RolesPage\n */\n\nimport { BasePage } from '../core/PageRouter.js';\nimport { graphService } from '../services/graphService.js';\nimport { CACHE_KEYS } from '../core/CacheManager.js';\n\nexport class PoliciesPage extends BasePage {\n    constructor(app) {\n        super(app);\n    }\n\n    /**\n     * Render Policies page\n     * @param {HTMLElement} container - Page container\n     * @param {Object} params - Optional parameters\n     */\n    async render(container, params = {}) {\n        container.innerHTML = `\n            <div class=\"page-header-row\">\n                <h1 class=\"page-header\">Role Policy Configuration</h1>\n            </div>\n            <p class=\"page-description\">Configure PIM activation settings for Entra ID roles. Select a role from the list to view and edit its policy.</p>\n\n            <div class=\"policy-layout\">\n                <div class=\"card policy-list\">\n                    <h3>Entra ID Roles</h3>\n                    <p class=\"caption\">Click a role to configure</p>\n                    <input type=\"text\" class=\"input\" placeholder=\"Filter roles...\" oninput=\"app.pages.policies.filterRoles(this.value)\">\n                    <div class=\"policy-items\" id=\"policy-role-list\">\n                        ${this.isConnected() ? '<p class=\"loading-text\">Loading roles...</p>' : '<p class=\"empty-text\">Connect to view roles</p>'}\n                    </div>\n                </div>\n                <div class=\"card policy-editor\">\n                    <div class=\"empty-state-large\">\n                        <i class=\"fas fa-file-alt\"></i>\n                        <h3>Select a role to configure its PIM policy</h3>\n                        <p>Configure activation duration, MFA requirements, justification, approval, and more.</p>\n                    </div>\n                </div>\n            </div>\n        `;\n\n        if (this.isConnected()) {\n            await this.loadRoles();\n        }\n    }\n\n    /**\n     * Load roles list\n     */\n    async loadRoles() {\n        // Try cache first\n        let roles = this.getCached(CACHE_KEYS.ROLES.key);\n\n        if (!roles) {\n            const result = await graphService.getRoleDefinitions();\n            if (result.success) {\n                roles = result.roles;\n                this.setCached(CACHE_KEYS.ROLES.key, roles);\n            } else {\n                this.showToast(`Failed to load roles: ${result.error}`, 'error');\n                return;\n            }\n        }\n\n        this.allRoles = roles;\n        this.displayRoles(roles);\n    }\n\n    /**\n     * Display roles in list\n     * @param {Array} roles - Roles to display\n     */\n    displayRoles(roles) {\n        const listContainer = document.getElementById('policy-role-list');\n        if (!listContainer) return;\n\n        listContainer.innerHTML = roles.map(r => `\n            <div class=\"policy-item\" onclick=\"app.pages.policies.selectRole('${r.id}', '${this.escapeHtml(r.displayName)}')\">\n                <strong>${this.escapeHtml(r.displayName)}</strong>\n            </div>\n        `).join('');\n    }\n\n    /**\n     * Filter roles by search query\n     * @param {string} query - Search query\n     */\n    filterRoles(query) {\n        if (!this.allRoles) return;\n\n        const filtered = this.allRoles.filter(role =>\n            role.displayName.toLowerCase().includes(query.toLowerCase())\n        );\n\n        this.displayRoles(filtered);\n    }\n\n    /**\n     * Select role for policy configuration\n     * @param {string} roleId - Role ID\n     * @param {string} roleName - Role display name\n     */\n    async selectRole(roleId, roleName) {\n        // Navigate to roles page with this role selected for policy configuration\n        // For now, show a message that full policy editor is in Roles page\n        this.showToast(`Policy configuration for ${roleName} - Use Roles page for full editor`, 'info');\n\n        // Optionally navigate to roles page\n        // await this.app.router.navigateTo('entra-roles', { selectedRole: roleId });\n    }\n\n    /**\n     * Refresh page data\n     */\n    async refreshPage() {\n        this.app.cacheManager.invalidate(CACHE_KEYS.ROLES.key);\n        await this.app.router.refreshCurrentPage();\n    }\n}\n"],"names":["PoliciesPage","BasePage","app","container","params","roles","CACHE_KEYS","result","graphService","listContainer","r","query","filtered","role","roleId","roleName"],"mappings":"yFAUO,MAAMA,UAAqBC,CAAS,CACvC,YAAYC,EAAK,CACb,MAAMA,CAAG,CACb,CAOA,MAAM,OAAOC,EAAWC,EAAS,GAAI,CACjCD,EAAU,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,0BAYJ,KAAK,cAAgB,+CAAiD,iDAAiD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,UAarI,KAAK,eACL,MAAM,KAAK,UAAS,CAE5B,CAKA,MAAM,WAAY,CAEd,IAAIE,EAAQ,KAAK,UAAUC,EAAW,MAAM,GAAG,EAE/C,GAAI,CAACD,EAAO,CACR,MAAME,EAAS,MAAMC,EAAa,mBAAkB,EACpD,GAAID,EAAO,QACPF,EAAQE,EAAO,MACf,KAAK,UAAUD,EAAW,MAAM,IAAKD,CAAK,MACvC,CACH,KAAK,UAAU,yBAAyBE,EAAO,KAAK,GAAI,OAAO,EAC/D,MACJ,CACJ,CAEA,KAAK,SAAWF,EAChB,KAAK,aAAaA,CAAK,CAC3B,CAMA,aAAaA,EAAO,CAChB,MAAMI,EAAgB,SAAS,eAAe,kBAAkB,EAC3DA,IAELA,EAAc,UAAYJ,EAAM,IAAIK,GAAK;AAAA,+EAC8BA,EAAE,EAAE,OAAO,KAAK,WAAWA,EAAE,WAAW,CAAC;AAAA,0BAC9F,KAAK,WAAWA,EAAE,WAAW,CAAC;AAAA;AAAA,SAE/C,EAAE,KAAK,EAAE,EACd,CAMA,YAAYC,EAAO,CACf,GAAI,CAAC,KAAK,SAAU,OAEpB,MAAMC,EAAW,KAAK,SAAS,OAAOC,GAClCA,EAAK,YAAY,YAAW,EAAG,SAASF,EAAM,YAAW,CAAE,CACvE,EAEQ,KAAK,aAAaC,CAAQ,CAC9B,CAOA,MAAM,WAAWE,EAAQC,EAAU,CAG/B,KAAK,UAAU,4BAA4BA,CAAQ,oCAAqC,MAAM,CAIlG,CAKA,MAAM,aAAc,CAChB,KAAK,IAAI,aAAa,WAAWT,EAAW,MAAM,GAAG,EACrD,MAAM,KAAK,IAAI,OAAO,mBAAkB,CAC5C,CACJ"}