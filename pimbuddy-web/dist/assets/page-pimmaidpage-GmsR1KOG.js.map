{"version":3,"file":"page-pimmaidpage-GmsR1KOG.js","sources":["../../src/pages/PimmaidPage.js"],"sourcesContent":["/**\n * PIMMaid Page\n * Visualize PIM configuration as Mermaid diagrams\n */\n\nimport { BasePage } from '../core/PageRouter.js';\nimport { graphService } from '../services/graphService.js';\nimport { pimmaidService } from '../services/pimmaidService.js';\n\nexport class PimmaidPage extends BasePage {\n    constructor(app) {\n        super(app);\n    }\n\n    /**\n     * Render PIMMaid page\n     * @param {HTMLElement} container - Page container\n     * @param {Object} params - Optional parameters\n     */\n    async render(container, params = {}) {\n        const diagramTypes = pimmaidService.getDiagramTypes();\n\n        container.innerHTML = `\n            <div class=\"page-header-row\">\n                <h1 class=\"page-header\">\n                    <i class=\"fas fa-project-diagram\"></i> PIMMaid\n                </h1>\n                <span class=\"page-subtitle\">Visualize PIM as Mermaid Diagrams</span>\n            </div>\n            <p class=\"page-description\">Generate visual diagrams of your PIM configuration showing relationships between users, groups, and roles.</p>\n\n            <div class=\"pimmaid-layout\">\n                <div class=\"pimmaid-controls card\">\n                    <h3><i class=\"fas fa-sliders-h\"></i> Diagram Options</h3>\n\n                    <div class=\"form-group\">\n                        <label>Diagram Type</label>\n                        <div class=\"diagram-type-grid\">\n                            ${Object.entries(diagramTypes).map(([key, type]) => `\n                                <label class=\"diagram-type-option ${key === 'full-hierarchy' ? 'selected' : ''}\" data-type=\"${key}\">\n                                    <input type=\"radio\" name=\"diagram-type\" value=\"${key}\" ${key === 'full-hierarchy' ? 'checked' : ''}>\n                                    <i class=\"fas ${type.icon}\"></i>\n                                    <span class=\"type-name\">${type.name}</span>\n                                    <span class=\"type-desc\">${type.description}</span>\n                                </label>\n                            `).join('')}\n                        </div>\n                    </div>\n\n                    <div class=\"form-group\">\n                        <label>Options</label>\n                        <div class=\"checkbox-group\">\n                            <label class=\"checkbox-label\">\n                                <input type=\"checkbox\" id=\"pimmaid-eligible\" checked>\n                                <span>Show Eligible Assignments</span>\n                            </label>\n                            <label class=\"checkbox-label\">\n                                <input type=\"checkbox\" id=\"pimmaid-active\" checked>\n                                <span>Show Active Assignments</span>\n                            </label>\n                        </div>\n                    </div>\n\n                    <div class=\"form-group\">\n                        <label>Direction</label>\n                        <select id=\"pimmaid-direction\" class=\"input\">\n                            <option value=\"LR\">Left to Right</option>\n                            <option value=\"TB\">Top to Bottom</option>\n                            <option value=\"RL\">Right to Left</option>\n                            <option value=\"BT\">Bottom to Top</option>\n                        </select>\n                    </div>\n\n                    <button class=\"btn btn-primary btn-block\" onclick=\"app.pages.pimmaid.generateDiagram()\" ${!this.isConnected() ? 'disabled' : ''} aria-label=\"Generate Mermaid diagram\">\n                        <i class=\"fas fa-magic\"></i> Generate Diagram\n                    </button>\n\n                    <div id=\"pimmaid-stats\" class=\"pimmaid-stats hidden\"></div>\n                </div>\n\n                <div class=\"pimmaid-output card\">\n                    <div class=\"pimmaid-output-header\">\n                        <h3><i class=\"fas fa-code\"></i> Mermaid Output</h3>\n                        <div class=\"pimmaid-actions\">\n                            <button class=\"btn btn-sm btn-secondary\" onclick=\"app.pages.pimmaid.copyCode()\" id=\"copy-mermaid-btn\" disabled aria-label=\"Copy Mermaid code\">\n                                <i class=\"fas fa-copy\"></i> Copy\n                            </button>\n                            <button class=\"btn btn-sm btn-secondary\" onclick=\"app.pages.pimmaid.downloadCode()\" id=\"download-mermaid-btn\" disabled aria-label=\"Download Mermaid code\">\n                                <i class=\"fas fa-download\"></i> Download\n                            </button>\n                            <button class=\"btn btn-sm btn-secondary\" onclick=\"app.pages.pimmaid.openInMermaidLive()\" id=\"live-mermaid-btn\" disabled aria-label=\"Open in Mermaid Live Editor\">\n                                <i class=\"fas fa-external-link-alt\"></i> Open in Mermaid Live\n                            </button>\n                        </div>\n                    </div>\n\n                    <div class=\"pimmaid-code-container\">\n                        <pre id=\"pimmaid-code\" class=\"pimmaid-code\">${this.isConnected() ? '// Click \"Generate Diagram\" to create your PIM visualization' : '// Connect to Azure AD to generate diagrams'}</pre>\n                    </div>\n\n                    <div class=\"pimmaid-preview-section\">\n                        <h4><i class=\"fas fa-eye\"></i> Preview</h4>\n                        <p class=\"preview-hint\">Paste the code above into <a href=\"https://mermaid.live\" target=\"_blank\" rel=\"noopener noreferrer\">Mermaid Live Editor</a> to see the rendered diagram.</p>\n                        <div id=\"pimmaid-preview\" class=\"pimmaid-preview\">\n                            <div class=\"empty-preview\">\n                                <i class=\"fas fa-project-diagram\"></i>\n                                <p>Diagram preview will appear here</p>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;\n\n        // Add event listeners for diagram type selection\n        document.querySelectorAll('.diagram-type-option').forEach(option => {\n            option.addEventListener('click', () => {\n                document.querySelectorAll('.diagram-type-option').forEach(o => o.classList.remove('selected'));\n                option.classList.add('selected');\n                option.querySelector('input').checked = true;\n            });\n        });\n    }\n\n    /**\n     * Generate PIMMaid diagram\n     */\n    async generateDiagram() {\n        const diagramType = document.querySelector('input[name=\"diagram-type\"]:checked')?.value || 'full-hierarchy';\n        const showEligible = document.getElementById('pimmaid-eligible').checked;\n        const showActive = document.getElementById('pimmaid-active').checked;\n        const direction = document.getElementById('pimmaid-direction').value;\n\n        this.showLoading('Fetching PIM data...');\n\n        try {\n            // Fetch all necessary data\n            const [groupsResult, rolesResult] = await Promise.all([\n                graphService.getPIMGroups(),\n                graphService.getRoleDefinitions()\n            ]);\n\n            if (!groupsResult.success || !rolesResult.success) {\n                throw new Error('Failed to fetch PIM data');\n            }\n\n            const groups = groupsResult.groups;\n            const roles = rolesResult.roles;\n\n            this.showLoading('Fetching assignments...');\n\n            // Fetch assignments based on diagram type\n            let groupAssignments = {};\n            let roleAssignments = {};\n\n            if (['user-group', 'full-hierarchy'].includes(diagramType)) {\n                const assignmentsResult = await graphService.getAllGroupAssignments(groups);\n                groupAssignments = assignmentsResult.assignments || {};\n            }\n\n            if (['group-role', 'full-hierarchy', 'role-assignments'].includes(diagramType)) {\n                const roleAssignmentsResult = await graphService.getAllRoleAssignments();\n                roleAssignments = roleAssignmentsResult.assignments || {};\n            }\n\n            this.hideLoading();\n\n            // Generate the diagram\n            const data = { groups, roles, groupAssignments, roleAssignments };\n            const options = { showEligible, showActive, direction };\n\n            const mermaidCode = pimmaidService.generateDiagram(diagramType, data, options);\n            const stats = pimmaidService.getStats(data);\n\n            // Update UI\n            document.getElementById('pimmaid-code').textContent = mermaidCode;\n            document.getElementById('copy-mermaid-btn').disabled = false;\n            document.getElementById('download-mermaid-btn').disabled = false;\n            document.getElementById('live-mermaid-btn').disabled = false;\n\n            // Show stats\n            const statsDiv = document.getElementById('pimmaid-stats');\n            statsDiv.innerHTML = `\n                <h4><i class=\"fas fa-chart-bar\"></i> Statistics</h4>\n                <div class=\"stats-grid\">\n                    <div class=\"stat-item\">\n                        <span class=\"stat-value\">${stats.totalUsers}</span>\n                        <span class=\"stat-label\">Users</span>\n                    </div>\n                    <div class=\"stat-item\">\n                        <span class=\"stat-value\">${stats.totalGroups}</span>\n                        <span class=\"stat-label\">Groups</span>\n                    </div>\n                    <div class=\"stat-item\">\n                        <span class=\"stat-value\">${stats.totalRoles}</span>\n                        <span class=\"stat-label\">Roles</span>\n                    </div>\n                    <div class=\"stat-item\">\n                        <span class=\"stat-value\">${stats.eligibleAssignments}</span>\n                        <span class=\"stat-label\">Eligible</span>\n                    </div>\n                    <div class=\"stat-item\">\n                        <span class=\"stat-value\">${stats.activeAssignments}</span>\n                        <span class=\"stat-label\">Active</span>\n                    </div>\n                </div>\n                <div class=\"role-stats\">\n                    <span class=\"badge privilege-badge badge-critical\">${stats.rolesByPrivilege.critical} Critical</span>\n                    <span class=\"badge privilege-badge badge-high\">${stats.rolesByPrivilege.high} High</span>\n                    <span class=\"badge privilege-badge badge-medium\">${stats.rolesByPrivilege.medium} Medium</span>\n                    <span class=\"badge privilege-badge badge-low\">${stats.rolesByPrivilege.low} Low</span>\n                </div>\n            `;\n            statsDiv.classList.remove('hidden');\n\n            // Update preview hint\n            document.getElementById('pimmaid-preview').innerHTML = `\n                <div class=\"preview-placeholder\">\n                    <i class=\"fas fa-check-circle\"></i>\n                    <p>Diagram generated! Copy the code or open in Mermaid Live to view.</p>\n                    <p class=\"code-lines\">${mermaidCode.split('\\n').length} lines generated</p>\n                </div>\n            `;\n\n            this.showToast('Diagram generated successfully', 'success');\n\n        } catch (error) {\n            this.hideLoading();\n            this.showToast('Failed to generate diagram: ' + error.message, 'error');\n        }\n    }\n\n    /**\n     * Copy Mermaid code to clipboard\n     */\n    copyCode() {\n        const code = document.getElementById('pimmaid-code').textContent;\n        navigator.clipboard.writeText(code).then(() => {\n            this.showToast('Mermaid code copied to clipboard', 'success');\n        }).catch(() => {\n            this.showToast('Failed to copy', 'error');\n        });\n    }\n\n    /**\n     * Download Mermaid code as file\n     */\n    downloadCode() {\n        const code = document.getElementById('pimmaid-code').textContent;\n        const blob = new Blob([code], { type: 'text/plain' });\n        const url = URL.createObjectURL(blob);\n        const a = document.createElement('a');\n        a.href = url;\n        a.download = `pimmaid-diagram-${new Date().toISOString().split('T')[0]}.mmd`;\n        document.body.appendChild(a);\n        a.click();\n        document.body.removeChild(a);\n        URL.revokeObjectURL(url);\n        this.showToast('Diagram downloaded', 'success');\n    }\n\n    /**\n     * Open diagram in Mermaid Live Editor\n     */\n    openInMermaidLive() {\n        const code = document.getElementById('pimmaid-code').textContent;\n\n        // Create state object for Mermaid Live\n        const stateObj = {\n            code: code,\n            mermaid: { theme: 'dark' }\n        };\n        const state = btoa(JSON.stringify(stateObj));\n\n        window.open(`https://mermaid.live/edit#base64:${state}`, '_blank');\n    }\n\n    /**\n     * Refresh page data\n     */\n    async refreshPage() {\n        await this.app.router.refreshCurrentPage();\n    }\n}\n"],"names":["PimmaidPage","BasePage","app","container","params","diagramTypes","pimmaidService","key","type","option","o","diagramType","showEligible","showActive","direction","groupsResult","rolesResult","graphService","groups","roles","groupAssignments","roleAssignments","data","options","mermaidCode","stats","statsDiv","error","code","blob","url","a","stateObj","state"],"mappings":"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"}